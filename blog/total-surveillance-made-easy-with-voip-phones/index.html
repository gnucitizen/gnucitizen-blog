<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Total surveillance made easy with VoIP phones</title><meta name="description" content="Remember the article about call jacking with the BT Home Hub? Here is something comparable but pretty new. Since Ronald and pdp had announced the router hacking challenge, I've decided to play around a little bit and as a result I've managed to find a rather interesting issue. Although not directly related to the router hacking contest, the results I've got were rather disturbing and made me get a totally new view on the VoIP phone security landscape."><meta property="name" content="Total surveillance made easy with VoIP phones"><meta itemprop="name" content="Total surveillance made easy with VoIP phones"><meta property="description" content="Remember the article about call jacking with the BT Home Hub? Here is something comparable but pretty new. Since Ronald and pdp had announced the router hacking challenge, I've decided to play around a little bit and as a result I've managed to find a rather interesting issue. Although not directly related to the router hacking contest, the results I've got were rather disturbing and made me get a totally new view on the VoIP phone security landscape."><meta itemprop="description" content="Remember the article about call jacking with the BT Home Hub? Here is something comparable but pretty new. Since Ronald and pdp had announced the router hacking challenge, I've decided to play around a little bit and as a result I've managed to find a rather interesting issue. Although not directly related to the router hacking contest, the results I've got were rather disturbing and made me get a totally new view on the VoIP phone security landscape."><meta property="image" content="https://www.gnucitizen.org/files/2008/02/snom-screen1-255x150.png &quot;Snom Screen1&quot;"><meta itemprop="image" content="https://www.gnucitizen.org/files/2008/02/snom-screen1-255x150.png &quot;Snom Screen1&quot;"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/total-surveillance-made-easy-with-voip-phones/"><meta property="og:title" content="Total surveillance made easy with VoIP phones"><meta property="og:description" content="Remember the article about call jacking with the BT Home Hub? Here is something comparable but pretty new. Since Ronald and pdp had announced the router hacking challenge, I've decided to play around a little bit and as a result I've managed to find a rather interesting issue. Although not directly related to the router hacking contest, the results I've got were rather disturbing and made me get a totally new view on the VoIP phone security landscape."><meta property="og:image" content="https://www.gnucitizen.org/files/2008/02/snom-screen1-255x150.png &quot;Snom Screen1&quot;"><meta name="twitter:title" content="Total surveillance made easy with VoIP phones"><meta name="twitter:description" content="Remember the article about call jacking with the BT Home Hub? Here is something comparable but pretty new. Since Ronald and pdp had announced the router hacking challenge, I've decided to play around a little bit and as a result I've managed to find a rather interesting issue. Although not directly related to the router hacking contest, the results I've got were rather disturbing and made me get a totally new view on the VoIP phone security landscape."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://www.gnucitizen.org/files/2008/02/snom-screen1-255x150.png &quot;Snom Screen1&quot;"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Total surveillance made easy with VoIP phones</h1><div class="date">Mon, 11 Feb 2008 23:03:43 GMT</div><div class="author">by
mario-heiderich</div><div id="post-content"><p>Remember the article about <a href="/blog/call-jacking">call jacking</a> with the BT Home Hub? Here is something comparable but pretty new. Since <a href="http://0x000000.com/">Ronald</a> and <a href="http://www.gnucitizen.org/about/pdp">pdp</a> had announced the <a href="/blog/router-hacking-challenge">router hacking challenge</a>, I&#39;ve decided to play around a little bit and as a result I&#39;ve managed to find a rather interesting issue. Although not directly related to the router hacking contest, the results I&#39;ve got were rather disturbing and made me get a totally new view on the VoIP phone security landscape.</p>
<p>Most modern VoIP phones come with a Web interface which you can use for administrative purposes mainly. The user can adjust the device&#39;s settings, like change the display messages, maintain the address books and on some models even make phone calls from the Web interface. Since the device we&#39;ve tested supports that particular functionality (<strong>call a number via a simple POST request</strong>) I&#39;ve decided to have a look at the markup a little bit closer, not knowing what hornet&#39;s nest I was eventually going to stir up. The device we are talking about is the <strong>Snom 32x</strong> - a pretty common device that can be found in several medium and large offices.</p>
<p><em>The Web interface of the Snom 32x VoIP phone suffers from many vulnerabilities that may cause financial and reputation trouble for the organizations that trusts them in their network. The vulnerabilities are based on common attack vectors, such as XSS and CSRF.</em></p>
<p>It is essential to keep in mind that, in order to attack the Snom 32x Web interface, the attacker requires knowledge of its IP address. This knowledge can be obtained by using a XSS Intranet scanning technique or via a plain guessing/bruteforce method. By looping through several IP addresses with JavaScript, looking for URLs like <code>http://xxx.xxx.xxx.xxx/img/logo2.gif</code>, we can easily locate the Web interface of the device. Of course a quick <a href="http://nmap.org/">nmap</a> scan delivers equivalent results with more ease and less time required. It is important to note that some networks use predictable names which also can also be used to pin-point a vulnerable device.</p>
<p>After discovering the device the attacker has several possibilities for evilness. Let&#39;s have a look at some of them:</p>
<ul>
<li>call arbitrary people via the Web interface via the means of CSRF.</li>
<li>make the call history <em>invisible</em> by calling a number like <code>&quot;&#39;);</code> which causes the Flash application displaying the most recent calls to crash.</li>
<li>steal the phone history from the logs including any other details attached to the calls via XHR.</li>
<li>poison the address book with a persistent XSS - the name is encoded correctly but not the phone number.</li>
<li>inject a JavaScript worm to gain total control over the user by changing the visible output by performing XHR-CSRF attack.</li>
<li>change the settings of registered phones, including the displayed text on the phone&#39;s display.</li>
<li>Last but not least, monitoring the victim by making a phone call to the attacker&#39;s number, who in tern will accept the call and recording the incoming sound. Note that the phone doesn&#39;t give any noticeable feedback (ring tones, etc) while the victim was kept under surveillance. Keep in mind that the victim pays for the call.</li>
</ul>
<p>It is also important to note that:</p>
<ul>
<li>None of the tested forms use tokens or other methods to make it harder to perform CSRF attacks against the Web interface.</li>
<li>The phone comes with a default password, which is <a href="http://www.cirt.net/cgi-bin/passwd.pl?method=showven&amp;ven=Snom">0000</a>. You can pick this information from Google.</li>
</ul>
<p>Let&#39;s have a look at a proper scenario. If the attacker knows the IP of the device&#39;s Web interface he/she can disable and/or hijack the whole phone within a few minutes. By crafting a XSS-CSRF vector he/she can inject a persistent XSS into the address book. When the victim visits the phone book, the XSS worm is silently executed and the attacker gains a total control over the interface and the actions that will be performed in the future. This also circumvents any protection mechanisms like VPN or comparable network layers, etc. And yes, in the worst case scenario the attacker will be able to survey the sound in the room in and cleanup the logs afterwords.</p>
<p>The whole device seemed to be especially designed for these issues to work. It is not like the situation where a small design flaw endangers the entire security model like many other <a href="/blog/google-gmail-e-mail-hijack-technique/">cases</a>. This time almost any available feature was buggy and vulnerable, and it kind of seems like a wonder that those phones are shipped all over the world and nothing major have happened yet. I&#39;ve tried to patch the phone with the latest firmware but that didn&#39;t work - the phone was  temporarily disabled after the process and when it began responding again the firmware version was still the same. So, even if there are patches for those devices they sometimes can&#39;t be used at all. It is very probable that other phones from other companies have the same or at least similar issues, so don&#39;t consider this post as a blame on a certain company. We&#39;d rather point out severe issues that kind of compare to Web hacking scene in the nineties and have them fixed urgently - no matter what phone is used or which company have built it.</p>
<div class="message">Please check the VoIP devices that you use and verify that the Web interfaces implements strong passwords and enforces some minimum security level. Contact the company who built the device and do bug them with you concerns. This will help generating a less dangerous situation for you and other VoIP phone users. Vulnerabilities like the one mentioned above could cost you or your company great amounts of money, reputation loss and even large scale information theft.</div>

<p>The <a href="/files/2008/02/snom.htm">proof of concept</a>  (POC) code can be found over here (please use it responsibly):</p>
<pre><code>[/files/2008/02/snom.htm](/files/2008/02/snom.htm)</code></pre><p>... and some supporting screenshots follow here:</p>
<div class="screen">
[![Snom Screen1](/files/2008/02/snom-screen1-255x150.png "Snom Screen1")](/files/2008/02/snom-screen1.png)
[![Snom Screen2](/files/2008/02/snom-screen2-255x150.png "Snom Screen2")](/files/2008/02/snom-screen2.png)
[![Snom Screen3](/files/2008/02/snom-screen3-255x150.png "Snom Screen3")](/files/2008/02/snom-screen3.png)
[![Snom Screen4](/files/2008/02/snom-screen4-255x150.png "Snom Screen4")](/files/2008/02/snom-screen4.png)
</div>

<p><em>Snom has been contacted in several ways but we haven&#39;t got any responded yet. We will keep you posted about any news. Feel free to comment - we are very looking forward discussing those issues more in depth.</em></p>
<h3 id="update-14-feb-2008">Update: 14 Feb 2008</h3>
<p>We&#39;ve received a response from Snom. This is what they say.</p>
<blockquote>
<p>To prevent this we will take the following measurments:</p>
<ul>
<li>We will publish an article on &quot;how to make your snom phone saver&quot; on our website (including a link to it on the start page)</li>
<li>We will send out a newsletter to all our registred VARS and distributers with this information</li>
<li>We will work on the FW to improve security (just checked, on FW Ver. 7 the Flash applet is disabled by default)</li>
<li>We will publish a new email adress, for security matters (mostlikly <a href="mailto:security@snom.com">security@snom.com</a>), which goes to a bunch of people (including me).&gt; </li>
</ul>
<p><em>We are thankful for letting us know about your future plans.</em></p>
</blockquote>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/684b988d3240f16f6a4566ba5869f187?s=256&amp;d=retro" alt="Gareth Heyes"><span class="post-comment-author">Gareth Heyes</span><div class="post-comment-content">Awesome stuff Mario!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/e1ee777ac8ed0a44d77f5abea723664b?s=256&amp;d=retro" alt="cirrus"><span class="post-comment-author">cirrus</span><div class="post-comment-content">Nice research. I'd like to add that some VoIP phones come with intercom mode enabled by default. This means that by sending it a special SIP request (using the SIP header: <code>Call-Info: ; answer-after=0</code>), one can monitor what is being said in the room, just by calling the phone, as the phone automatically answers the call and puts it thru the speakerphone. One example of such a phone is the Linksys SPA941 (which in its older firmware versions used to have the intercom mode enabled by default). There are probably others that come with this "feature" enabled by default and there is always the possibility that one could use an XSS/CSRF to enable it if disabled.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">cirrus, this is very, very interesting. 10x for the tip.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/89886495b27cfdc78593e1f5c8810594?s=256&amp;d=retro" alt=".mario"><span class="post-comment-author">.mario</span><div class="post-comment-content">Interesting indeed! I haven't had a deeper look into those kinds of features but probably will during the next weeks.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/89886495b27cfdc78593e1f5c8810594?s=256&amp;d=retro" alt=".mario"><span class="post-comment-author">.mario</span><div class="post-comment-content">Just FYI: Meanwhile I was contacted by Snom and we managed to work out plans for securing the affected devices. Hats off to Snom - long time no such great reaction!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/18a299fdf3154980834c13a2ae67f476?s=256&amp;d=retro" alt="reid"><span class="post-comment-author">reid</span><div class="post-comment-content">one of the nice things about Snom, instead of just web page linked to there that initiates a call with an HTTP string, just do it from outlook http://wiki.snom.com/Outlook_Add_In</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/18a299fdf3154980834c13a2ae67f476?s=256&amp;d=retro" alt="reid"><span class="post-comment-author">reid</span><div class="post-comment-content">Also, the more interesting attack to me would be to factory reset the phones remotely.

"http://phonesIpAdr/advanced.htm?reset=Reset" will factory default a phone. 

In many service provider based setups there will be QoS tagging, VLAN tagging, proxy information, along with the SIP credentials. If you managed a CSRF attack to factory default the phone, better yet, a scripted attack that could scan a whole subnet, find the Snom phones and pass the HTTP GET, you're looking at a significant outage.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/89886495b27cfdc78593e1f5c8810594?s=256&amp;d=retro" alt=".mario"><span class="post-comment-author">.mario</span><div class="post-comment-content">@reid: This sounds very interesting. Keep the Snom guys posted - they are currently implementing a security@snom.com mail address and many other clever ideas of securing the devices so the intent of the article has come reality - awareness was generated - win-win.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/18a299fdf3154980834c13a2ae67f476?s=256&amp;d=retro" alt="reid"><span class="post-comment-author">reid</span><div class="post-comment-content">Sorry, a bit of a distraction but I was doing a bit more googling, it's disturbing what you can come up with by a simple inurl: search on google (the /img/logo2.gif doesn't pop up anything so I was trying a couple others)

Are you guys doing anything as far as seeing what data can be mined from the SIP traces (also available w/out admin rights on the phone)? The reason I ask is that I haven't done much personally on going through the SIP traces trying to figure out if it's possible to grab version and vulnerability info on the SIP server, proxy, SBC, whatever the phone is registering to. 

so consider, by getting to the phonoe itself I can draw out application version info and hardware specific info (MAC, etc.) on the specific phone as well call history, possibly SIP credentials. Flip that around, what if I can draw out information about the proxy or registrar common to ALL phones within a business and find an attack vector? Goes a little beyond a simple XSS attack I think but something maybe worth looking into. Would also potentially be much a much wider attack surface for MITM and spearphishing attacks. Alright, I'm going to stop the use of jargon and acronyms now because it's begining to annoy even me.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/b42e4e4f5f11bd4beb2caa67d03a6d8e?s=256&amp;d=retro" alt="J4zen"><span class="post-comment-author">J4zen</span><div class="post-comment-content">Nice writeup, i've actually stumbled upon this myself during the last year or so while working with SNOM320's. They indeed do have a large number of vulnerabilities BUT, the firmware is open source(not many people know this). Thus you could go fix it yourself if you do stumble upon a bug that needs immediate attention.

Also it might be worth mentioning, a lot of VOIP-platforms are ran on a popular piece of software called Asterisk(or distros using Asterisk such as FreePBX/CentPBX/Elastix/Trixbox/etc). 

You'd be amazed exactly how many vulnerabilities are in their software that can easely result in bankruptcy.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/e53f5d616931bfe8fa74bfd9f72e049e?s=256&amp;d=retro" alt=".mario"><span class="post-comment-author">.mario</span><div class="post-comment-content">I just returned from CeBIT in Hannover, Germany where I was invited to a event organized by snom due to this exact article and it was pretty interesting. 

Peter Cox was there and other very interesting people to talk to. I had pretty good discussions with the developers of the snom web interface and I got a preview on the new phone firmware. It definite has been improved a lot and I got a phone for my private lab to test for more issues. 

So my impression of this day is a good thumbs up to snom - let's see what can be found in the most recent firmware ;)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/85e4239ff9662bf8296083d98da17677?s=256&amp;d=retro" alt="Jonas"><span class="post-comment-author">Jonas</span><div class="post-comment-content">Ok, I've got a bunch of these on public IPs. Am I in trouble?

This article clearly states that if the IP is known an attacker can hijack the phone. Snom says otherwise; only if you have failed to set a password on it (obviously). I came here from the Snom security announcement which downplays this attack. This worries me gravely.

On the other hand this article is light on details. The only code is how to make calls once you're in, which would be unrelated to the actual attack.

Now that the manufacturer has responded, can you please publish more information so we can properly determine if we are at risk?</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/ef14ae4ef69235fa6c3709438357819d?s=256&amp;d=retro" alt="Adrian 'pagvac' Pastor"><span class="post-comment-author">Adrian 'pagvac' Pastor</span><div class="post-comment-content">@Jonas: put it this way, if the attacker can talk to the Snom's IP phone web server (as in the case of Internet-visible phones), then he can make the phone start any VoIP calls WITHOUT a password. This is because the CGI script that handles such POST requests is publicly available (can be talked to, without a password).

Quoted from .mario's post, some possible attacks include:

"monitoring the victim by making a phone call to the attackerâ€™s number, who in tern will accept the call and recording the incoming sound. Note that the phone doesnâ€™t give any noticeable feedback (ring tones, etc) while the victim was kept under surveillance. Keep in mind that the victim pays for the call."

If I were you I would restrict access to such phones from the LAN only *immediately*.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/85e4239ff9662bf8296083d98da17677?s=256&amp;d=retro" alt="Jonas"><span class="post-comment-author">Jonas</span><div class="post-comment-content">Adrian: Thank you for your reply. It does not help me however. If I just POST the data to the phone it replies with "unauthorized", obviously, as I did not send the required HTTP authentication.

Apparently there is something else to this. Can somebody PLEASE speak up on this! I just need to know this is actually an issue. I can't start limiting access to phones based on nothing.

Can you just show a dump on a working request, or anything at all that can convince me this works?</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/ef14ae4ef69235fa6c3709438357819d?s=256&amp;d=retro" alt="Adrian 'pagvac' Pastor"><span class="post-comment-author">Adrian 'pagvac' Pastor</span><div class="post-comment-content">@Jonas: it's not just any POST request, it has to be the request that starts a conversation. Just use the PoC (proof of concept): http://www.gnucitizen.org/blog/total-surveillance-made-easy-with-voip-phones/snom.htm

Sorry, but we can't make it easier than that. Keep in mind that .mario tested the attacks on Snom 32x and by the way, all the vulnerabilities were confirmed by Snom, so you can bet this IS a real issue.

Also remember that stealing calls and eavesdropping the room where the phone is located are not the only vulnerabilities found by .mario.

As I said, connecting these phones directly to the internet is asking to get pwned!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/85e4239ff9662bf8296083d98da17677?s=256&amp;d=retro" alt="Jonas"><span class="post-comment-author">Jonas</span><div class="post-comment-content">Adrian: I'm not sure what you mean by starting a conversation, but I mean the POST request that initiates a call, normally called through the web interface.

I wouldn't have asked if your proof of concept worked. I have tried it on several models on Snom phones, including the 320.

Snom did not confirm the vulnerabilities by the way. Did you read their security announcement? I read CVE-2008-1248, which gave me the impression that a manufacturer was trying to downplay a security issue which is why I came here to find the truth.

But now I suspect that there was no issue to begin with..?</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/ef14ae4ef69235fa6c3709438357819d?s=256&amp;d=retro" alt="Adrian 'pagvac' Pastor"><span class="post-comment-author">Adrian 'pagvac' Pastor</span><div class="post-comment-content">Hi Jonas,

It appears that if you set a password you can resolve the unauthorized POST "initiate call" request issue: http://blog.tmcnet.com/blog/tom-keating/voip/snom-voip-vulnerability-resolved.asp

Careful: no password is set by default!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/ef14ae4ef69235fa6c3709438357819d?s=256&amp;d=retro" alt="Adrian 'pagvac' Pastor"><span class="post-comment-author">Adrian 'pagvac' Pastor</span><div class="post-comment-content">@Jonas: forgot to add that this is NOT my research, but Mario's (as shown in the post). Therefore, I suggest you to contact him directly if you have any more specific questions.

Also, thanks a lot for your feedback. It's always a very good habit to question everything you read.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/df6edcc7a9fab5e886a831ba2d6d6d6c?s=256&amp;d=retro" alt="etd"><span class="post-comment-author">etd</span><div class="post-comment-content">Don't know if you're aware, but this article made it's way into the "News Briefs" section of IEEE's Security &amp; Privacy (March/April 2008) :)

good job</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/dbb890d615e977e1f4fb1dc4b50290b9?s=256&amp;d=retro" alt="reid"><span class="post-comment-author">reid</span><div class="post-comment-content">okay so this is probably a bit old, but I found it amusing anyway.  We use snom phones internally and also for a hosted voip solution. I was looking for a phone on our LAN and (stupid) decided to do a quick port scan for it.

nmap 5.0 running service scan (-sV) option against a snom phone may cause the phone to reboot. I can do this on snom v7.1.33 and 7.1.39. Foudn it out this afternoon so i'm still raising a ticket with Snom. 

i've run earlier versions of nmap previously and it doesn't cause this kind of error. highly amusing to know i can jump on someone's LAN and cause all their phones to reboot.</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2022 <a href=""></a>. All rights reserved.</p></footer></body></html>