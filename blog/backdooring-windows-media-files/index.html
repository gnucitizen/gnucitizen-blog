<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Backdooring Windows Media Files</title><meta name="description" content="I am planning to keep this post short and sweet. So, here is the deal. Meta Files are dangerous! In this post I am planning to cover some security findings that concern files with extensions `.wax`, `.wvx`, `.asx` and `.wmx`."><meta property="name" content="Backdooring Windows Media Files"><meta itemprop="name" content="Backdooring Windows Media Files"><meta property="description" content="I am planning to keep this post short and sweet. So, here is the deal. Meta Files are dangerous! In this post I am planning to cover some security findings that concern files with extensions `.wax`, `.wvx`, `.asx` and `.wmx`."><meta itemprop="description" content="I am planning to keep this post short and sweet. So, here is the deal. Meta Files are dangerous! In this post I am planning to cover some security findings that concern files with extensions `.wax`, `.wvx`, `.asx` and `.wmx`."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbackdooring-windows-media-files%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbackdooring-windows-media-files%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/backdooring-windows-media-files/"><meta property="og:title" content="Backdooring Windows Media Files"><meta property="og:description" content="I am planning to keep this post short and sweet. So, here is the deal. Meta Files are dangerous! In this post I am planning to cover some security findings that concern files with extensions `.wax`, `.wvx`, `.asx` and `.wmx`."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbackdooring-windows-media-files%2F?w=1024"><meta name="twitter:title" content="Backdooring Windows Media Files"><meta name="twitter:description" content="I am planning to keep this post short and sweet. So, here is the deal. Meta Files are dangerous! In this post I am planning to cover some security findings that concern files with extensions `.wax`, `.wvx`, `.asx` and `.wmx`."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbackdooring-windows-media-files%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Backdooring Windows Media Files</h1><div class="date">Tue, 18 Sep 2007 12:51:31 GMT</div><div class="author">by
<a href="/members/pdp.html">pdp</a></div><div id="post-content"><p>I am planning to keep this post short and sweet. So, here is the deal. Meta Files are dangerous! In this post I am planning to cover some security findings that concern files with extensions <code>.wax</code>, <code>.wvx</code>, <code>.asx</code> and <code>.wmx</code>.</p>
<p>Before we continue with the fun stuff, you must understand the purpose of the file formats listed above. First of all, they are meta files just like Apple&#39;s <a href="/blog/0day-quicktime-pwns-firefox">QTL</a>. Second, they are standard for the Windows operating system and supported by default. Finally, the meta files are often used to stack together various media content into playlists.</p>
<p>if you start researching the Media Player meta files (<a href="http://msdn2.microsoft.com/en-us/library/aa393397.aspx">this</a> is a good resource to start), you will see that they all have the same structure, which is XML. The XML document (starting with root node <code>**&lt;ASX&gt;**</code>) provides the basic characteristics of how the media streams need to be played, what sequence they follow and how the user can interact with them. Digging deeper into the XML, I found several tags which can be abused for malicious purposes. I am going to cover only one of them, which I find the most interesting:</p>
<pre><code class="language-xml"><span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">"HTMLView"</span> <span class="attr">value</span>=<span class="string">"[url here]"</span>/&gt;</span></code></pre>
<p>From the <a href="http://msdn2.microsoft.com/en-us/library/aa392319.aspx">documentation</a>, the <code>HTMLView</code> value specifies:</p>
<blockquote>
<p>a URL that displays in the Now Playing pane of the full mode Player for the duration of the playlist or the current entry depending on whether the parent element is the ASX element or an ENTRY element. HTMLView is not supported for the Windows Media Player control.</p>
</blockquote>
<p>In simple words, <code>HTMLView</code> will display a page of our choice within the standalone Windows Media Player, i.e. the page will be opened within the Media Player&#39;s surroundings, not a standalone browser. This is in particular very interesting behavior, which I experimented with for a bit. I found that a fully patched windows XP SP2 with IE6 or IE7 and Windows Media Player 9 (default) will open any page of your choice in less restrictive Internet Explorer environment even if your default browser is Firefox, Opera or anything else you have for a browser. This means that even if you are running Firefox and you think that you are secure, by simply opening an ASX media file, you expose yourself to all kinds of IE vulnerabilities.</p>
<p>Like always, I prepared some POCs (check the bottom of the post) you can try running, which I supply just to demonstrate the issue without harming your system. Those of your who have Media Player 11 are sort of protected. Upon execution you will see a confirmation box. This is a good news for Vista users. However, given the fact that Media Player is not the most popular choice for the masses and Vista is still not widely adopted, attackers are in very good position to abuse the technology for their own good.</p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/5e0f595cbc8f1811233adce10ac6c5d3?s=256&amp;d=retro" alt="Awesome AnDrEw"><span class="post-comment-author">Awesome AnDrEw</span><div class="post-comment-content">I believe there's options within almost every version of Windows Media Player to at least ask for confirmation when attempting to load web content. The first thing I do when installing any media application is to set the privacy and security settings to deny access to the player ID and any script commands. I did allow it to connect for your demonstration, which was pretty cool.

Another thing I noticed is that you could probably do this without most users really understanding what is taking place, because upon viewing the proof of concept I was able to navigate back to the other blogs on your site within Windows Media Player, and then clicked the link to my own website. My own website has MP3s embedded within it, and upon viewing the page the MP3 immediately transferred itself to Windows Media Player's "Now Playing" list. So essentially this could be more even more dangerous if you were to place an embedded media file such as a blank WAV or MP3 to immediately mask any suspicious activity.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/5e0f595cbc8f1811233adce10ac6c5d3?s=256&amp;d=retro" alt="Awesome AnDrEw"><span class="post-comment-author">Awesome AnDrEw</span><div class="post-comment-content">I've been playing around with it for a few moments, and I see that certain scripting elements are disabled within Windows Media Player. A regular alert box will not execute when the content loads, but so far I see it supports other statements and properties such as location.href, window.open, and document.write. You're doing awesome work, PDP. Keep it up.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Awesome AnDrEw, the docs mention that both alert and confirm are disabled. I've tried to access the <strong>external</strong> object but with no luck. For the actual testing, I use a inbrowser JavaScript console. Hmmmm, let me create one POC for you guys to mess around. I will be back in a sec.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">You can use the <a href="http://www.gnucitizen.org/static/blog/2007/09/bwmf-console.asx" rel="nofollow">following POC</a> to script Windows Media Player from within. Once inside, click on the first link.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/e5cbad9527e23aeb9f3766f5c1e1c2e8?s=256&amp;d=retro" alt="Sam"><span class="post-comment-author">Sam</span><div class="post-comment-content">I tried in WMP10 and I still get a confirmation dialog, so seems WMP10 is about as secure as WMP11 in that respect.

However, I agree with you on the dangers of meta files. Generally it is a good idea to avoid them.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/1d3fc02c9a66b6f0222792f02f284b02?s=256&amp;d=retro" alt="/nul"><span class="post-comment-author">/nul</span><div class="post-comment-content">Nice work as always pdp. I've tested PoC on Windows Media Player 10 and 11. On both versions confirmation dialog pops-up. I suppose that only WMP9 (default on XP) is affected.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c5f240c71253599c1be1be455dc13bc3?s=256&amp;d=retro" alt="Rosario Valotta"><span class="post-comment-author">Rosario Valotta</span><div class="post-comment-content">Hi pdp, i've played a bit on these topics some months ago and I already noticed the wmp behaviour you depicted in the post. After some tests I gave up as in order to run javascript you need to play files in HTMLView mode, so no "hidden attack" can be performed (afaik)

I turned to investigate on possible exploitation of wmp in embedded html page. In this scenario, many DOM objects often used in scripts (document, parent, so on) are accessible from a JS script running from the the movie environment.

As reported in the official documentation, it is possible to edit wmp files in order to embed scripts and marker. Scripts can be of 2 types: URL (allow to launch URL in the browser window embedding the wmp) and TEXT. Text scripts are generally used for caption purposes but...if you use javascript syntax...it will be executed in the</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c5f240c71253599c1be1be455dc13bc3?s=256&amp;d=retro" alt="Rosario Valotta"><span class="post-comment-author">Rosario Valotta</span><div class="post-comment-content">embedding window. The only limit to this is that you must define in the  tag the HTML node (a DIV for example) where the TEXT script shoud be showed.

I've tried to embed a wmp in sites that allow video uploading (spaces.live.com, myspace.com) but the embed code always is sanitized so I had no succes in exploiting this functionality.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/4d096f0c01c34c101e711637a3c39d46?s=256&amp;d=retro" alt="FiSh"><span class="post-comment-author">FiSh</span><div class="post-comment-content">I've been reading your RSS feed for the past week or two, and let me tell you, you've scared me shitless! Keep up the good work ;)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/d8582ad45d02151e2f22560a64036336?s=256&amp;d=retro" alt="Joe Phantom"><span class="post-comment-author">Joe Phantom</span><div class="post-comment-content">Another excellent post about meta files danger.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/624e7d26d7a9a43d39ea76624a8fb6a6?s=256&amp;d=retro" alt="chucky"><span class="post-comment-author">chucky</span><div class="post-comment-content">good job man, this is pretty crazy</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/3d5808eeaf247697f1148988f53c6b4b?s=256&amp;d=retro" alt="CrashOne"><span class="post-comment-author">CrashOne</span><div class="post-comment-content">This example illustrates the lack of good security within MS products.

Althoug i think this wil be patched soon, simply change the default behaviour of WMP.

If your default player for WMP files isn't WMP (like VLC) your not vulnerable.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/ed10ac32a0bd307784871efc74312200?s=256&amp;d=retro" alt="Lff"><span class="post-comment-author">Lff</span><div class="post-comment-content">Guys, no one ever thought that windows itself and microsoft as a company are free from bugs and security holes... In general, microsoft is sucks by itself, no less no more. Everybosy, let us say: "Bill, we do not want your sloppy company anymore!"</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/16bbff61099696c7cd63ad803586f137?s=256&amp;d=retro" alt="Sergey Gordeychik"><span class="post-comment-author">Sergey Gordeychik</span><div class="post-comment-content">There are lot of other applications which use IE as  default rendering engine and can used to exploit IE's bugs. But via different vectors. 

Examples:

http://seclists.org/bugtraq/2005/Jul/0427.html
http://www.securitylab.ru/contest/212127.php (Russian)
http://www.securityfocus.com/bid/17913/references</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/bb1950e649d23ea1f807f6e59fa12d6f?s=256&amp;d=retro" alt="CX"><span class="post-comment-author">CX</span><div class="post-comment-content">No problem: try lite version WinXP SP2 Vista edition (175 Mb.) _WITHOUT WINDOWS MEDIA PLAYER_

:))</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/f91b7b3cabbfbd68774339eb98c7564b?s=256&amp;d=retro" alt="0xDeadFace"><span class="post-comment-author">0xDeadFace</span><div class="post-comment-content">I read and code your exploit but I'm missing something: the jscript you launch in wmp works well in an html file opened directly with ie. I mean: no need to use this wmp trick.

The advantage of your exploit is that you use the less restrictive security rules of wmp than ie for executing jscript. Correct?

May you put an example with such a jscript?

thx</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/f67ae868e54131ed534cee97644fbfda?s=256&amp;d=retro" alt="crypt1c_cyph3r"><span class="post-comment-author">crypt1c_cyph3r</span><div class="post-comment-content">Hello, everyone just want to say thanx for this info really appreciate the insight! I'm honestly fed up with MS(I call em MicroSh1t)! i'm just about ready to switch over to linux! u know ubuntu, just as soon as i can figure out how to get my internet connection up and running with it! just need a little help with the drivers i need and how to install them on ubuntu's linux os! i am using a Motorola SURFboard SB5120 USB Cable Modem and my isp is cox high speed internet! any help any1 could give me is much appreciated.

as i'm kinda new to the linux os!</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2022 <a href=""></a>. All rights reserved.</p></footer></body></html>