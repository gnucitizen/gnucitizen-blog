<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Browser Focus RIP</title><meta name="description" content="There was a discussion on Full-disclosure and Bugtraq about a very peculiar vulnerability in Internet Explorer and Mozilla Firefox which can be used by attackers to trick victims into uploading local files."><meta property="name" content="Browser Focus RIP"><meta itemprop="name" content="Browser Focus RIP"><meta property="description" content="There was a discussion on Full-disclosure and Bugtraq about a very peculiar vulnerability in Internet Explorer and Mozilla Firefox which can be used by attackers to trick victims into uploading local files."><meta itemprop="description" content="There was a discussion on Full-disclosure and Bugtraq about a very peculiar vulnerability in Internet Explorer and Mozilla Firefox which can be used by attackers to trick victims into uploading local files."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbrowser-focus-rip%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbrowser-focus-rip%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/browser-focus-rip/"><meta property="og:title" content="Browser Focus RIP"><meta property="og:description" content="There was a discussion on Full-disclosure and Bugtraq about a very peculiar vulnerability in Internet Explorer and Mozilla Firefox which can be used by attackers to trick victims into uploading local files."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbrowser-focus-rip%2F?w=1024"><meta name="twitter:title" content="Browser Focus RIP"><meta name="twitter:description" content="There was a discussion on Full-disclosure and Bugtraq about a very peculiar vulnerability in Internet Explorer and Mozilla Firefox which can be used by attackers to trick victims into uploading local files."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbrowser-focus-rip%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Browser Focus RIP</h1><div class="date">Mon, 12 Feb 2007 23:59:32 GMT</div><div class="author">by pdp</div><div id="post-content"><p>There was a <a href="http://seclists.org/fulldisclosure/2007/Feb/0226.html">discussion</a> on Full-disclosure and Bugtraq about a very peculiar vulnerability in Internet Explorer and Mozilla Firefox which can be used by attackers to trick victims into uploading local files.</p>
<p>It was <a href="http://lcamtuf.coredump.cx">Michal Zalewski</a> who brought this subject back on the table. The vulnerability he described is not new. In fact,  it is a variation of an issues discovered back in 2000. The peculiar thing about it is that it was reported to Mozilla&#39;s Bugzilla back then but never fixed.</p>
<p>If you read about what <a href="http://lcamtuf.coredump.cx/focusbug/">Michal&#39;s exploit</a> does, you can easily get lost, so I will try to explain the issue as clearly as I can and provide you with some examples of how it can be used in real attacks.</p>
<p>The only component in the DOM (Document Object Model) that allows us to send locally selected files to a remote location is the file input box, usually declared as <code>&lt;input type=&quot;file&quot;/&gt;</code>. This is not a standard input field because it has a browse button that is attached at the end and also because, once inside a <code>multipart/form-data</code> form, it can selected local files. Because of these characteristics, you cannot use JavaScript to set its value to a file path of your desire. If that was possible, everybody would be able to steal and list your file system remotely when you visit a malicious website.</p>
<p>However, by using a clever focus diversion tricks, attackers can make certain characters, that the victim typed, to leak inside the file input field. They can achieve that by using a filter that allows and disallows keyboard events based on the key code order in the file path string that needs to be retrieved.</p>
<p>In simple words, when the user types characters inside some text field, they are actually typing them inside a file input box, which filters out the unnecessary characters in order to compose the desired string. Everything else, is totally emulated, so the user thinks they are typing in the right place not knowing what is actually happening. The following text translates to <code>/etc/shadow</code>, which can be used to steal that particular file:</p>
<blockquote>
<p>Bob! Check this out <a href="http://www.example.com">http://www.example.com</a>. this is very cool: <a href="http://www.someserver.com">http://www.someserver.com</a>. hei man, do you still need that wonderful CD I gave you long time ago?</p>
</blockquote>
<p>You probably think that I am mad! Now, have a look at the following text, which shows all key characters that are required to build the file string.</p>
<blockquote>
<p>Bob! Check this out http:<code>[/]</code>/www.<code>[e]</code>xample.com. <code>[t]</code>his is very <code>[c]</code>ool: http:<code>[/]</code>/www.<code>[s]</code>omeserver.com. <code>[h]</code>ei m<code>[a]</code>n, <code>[do]</code> you still need that <code>[w]</code>onderful CD I gave you long time ago?</p>
</blockquote>
<p>Black magic! The filter removes the parts that are not required and only the characters that are needed are passed into the input field.</p>
<p>Although quite complicated, this attack is very real and probably should be taken seriously. If the attacker places the malicious JavaScript on a critical place where users are heavily using the keyboard, the chances of composing the desired string are quite high. Think about blogs, wiki entries, forums, etc. This issue can be shipped as part of an AJAX worm which propagates on the top of MySpace, for example.</p>
<p>In some situations the user doesn&#39;t need to type that much text at all. They can be tricked into typing the desired string in a much clever way. For example, the following sequence of characters composes the <code>/etc/shadow</code> string: <code>b/etlc/shradow</code>. It is not obvious that this 14 character long string corresponds to the 11 character long <code>/etc/shadow</code> path. Still, the question is how the attacker can force the victim to type these characters inside the page. Well, attackers need to be creative in this case. Check this two examples:</p>
<div class="message">

<p>You visit a page requires a CAPTCHA. You type the letters <code>b/etlc/</code> but you receive an error which tells you that your input was incorrect. Now you need to repeat the task and type the following sequence of characters: <code>shradow</code>.</p>
</div>

<p><em>Quite bad! My advice to you is to be careful. If you are using MySpace turn JavaScript off if possible. Don&#39;t use your keyboard on untrusted websites.</em></p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/8c5548eb0b2b80924f237953392df5e7?s=256&amp;d=retro" alt="Ben Bucksch"><span class="post-comment-author">Ben Bucksch</span><div class="post-comment-content"><blockquote>Mozillaâ€™s Bugzilla back then and still, none has fixed it.</blockquote>

Not correct. As mentioned in https://bugzilla.mozilla.org/show_bug.cgi?id=370092 and on FD, the big was fixed on Firefox trunk, before these reports. It's not yet on the Firefox 2 branch.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/f852d08a4aff0fda77f4c7ce3026180b?s=256&amp;d=retro" alt="Paul Rawdon"><span class="post-comment-author">Paul Rawdon</span><div class="post-comment-content">Re your vulnerabilities for Fire Fox and Internet Explorer 7. Have just tried the test with Internet Explorer 6 and Sea Monkey 1.0.7 (the replacement for Mozilla) and the same applies for these two as well. Fire-Fox's replacement Minefield appears to be immune to this problem.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/70f3624e5141ce2f2641a779497d3bcb?s=256&amp;d=retro" alt="Luca"><span class="post-comment-author">Luca</span><div class="post-comment-content">The latest Firefox released to the public is 2.0.0.1 and it's vulnerable. So the flaw is still unpatched!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">I am experimenting with Opera. It seams to be vulnerable too, although I don't have a working exploit right now.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/2965c85564924dfc952ed5d364425938?s=256&amp;d=retro" alt="Mephisto"><span class="post-comment-author">Mephisto</span><div class="post-comment-content">This is not good! This is the 2nd browser vulnerability in the last month that has allowed local file access. Well, actually the 3rd if you count the FireFox popup blocker issue as well.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/302beb62dc6f2f47acc9e3bbe2fe4f34?s=256&amp;d=retro" alt="Andrew"><span class="post-comment-author">Andrew</span><div class="post-comment-content">Firefox has many more security vulnerabilities:

www.FirefoxMyths.com</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/68af617b4ca087422d8d9b35732f678a?s=256&amp;d=retro" alt="Sebastian"><span class="post-comment-author">Sebastian</span><div class="post-comment-content">There are only very few websites that _require_ JavaScript, so I have disabled JavaScript by default. Most serious browser vulnerabilities were, are and will be based on active contents like JavaScript, JScript, Java, ActiveX, Flash etc.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">OK folks, I cannot reproduce the bug in Opera, although sometimes I get the feeling that it is possible. It seams that Opera is in fact the most secure browser, or maybe I am wrong.

Anyway, I will continue experimenting with my code and if I find anything interesting, I will post it here. Thanks.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/cd668b5d3b0b60de64704c1eee4cc1e2?s=256&amp;d=retro" alt="AC"><span class="post-comment-author">AC</span><div class="post-comment-content">Oh god Andrew, if you want to critisize software, at least use a source from a non-zealot then. This guy tries too hard to be one.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/120f6678dc7990a340d3ad465602bfd3?s=256&amp;d=retro" alt="John Dowdell"><span class="post-comment-author">John Dowdell</span><div class="post-comment-content">Thanks for the catch... "don't type lots on strange sites", I guess that's the takeaway.... :(

I don't know about Apollo... it's still in development. It will use the WebKit rendering engine, as Apple's Safari does, but I don't know the local file permissions system myself yet. A public release is still a bit aways, but such focus transfers would be a good thing to doublecheck, thanks.

jd/adobe</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Thanks John. Is it possible to have a copy of the Apollo engine? I might be able to spot some problems that can be fixed before the actual release. I am a bit busy right now, but it will be interesting if we can do that.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/120f6678dc7990a340d3ad465602bfd3?s=256&amp;d=retro" alt="John Dowdell"><span class="post-comment-author">John Dowdell</span><div class="post-comment-content">There will be a public release soon, but it's not here yet... http://www.adobe.com/go/apollo will redirect to the best page for latest info.

tx, jd/adobe</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/2edb06fde747554fffdea71f2f81b2d8?s=256&amp;d=retro" alt="sigma"><span class="post-comment-author">sigma</span><div class="post-comment-content"> : I would lower the opacity of the browser logos to make it more realistic :)

cheers!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/2edb06fde747554fffdea71f2f81b2d8?s=256&amp;d=retro" alt="sigma"><span class="post-comment-author">sigma</span><div class="post-comment-content">"kind of off-topic: " (was removed from the upper comment because I used "great than" and "lower than" ^^ ) - tighten the filters eh pdp ?  :) </div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">not really</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=256&amp;d=retro" alt="a064c4b89718"><span class="post-comment-author">a064c4b89718</span><div class="post-comment-content"><strong>a064c4b89718</strong>

a064c4b89718d00cfb93</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2021 <a href=""></a>. All rights reserved.</p></footer></body></html>