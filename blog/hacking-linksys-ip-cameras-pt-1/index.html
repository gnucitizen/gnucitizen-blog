<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Hacking Linksys IP Cameras (pt 1)</title><meta name="description" content="During the easter break, I was playing with my my wireless Linksys IP camera which, although I bought several months ago, I hadn't taken my time to give the attention this beauty deserves until now! :)"><meta property="name" content="Hacking Linksys IP Cameras (pt 1)"><meta itemprop="name" content="Hacking Linksys IP Cameras (pt 1)"><meta property="description" content="During the easter break, I was playing with my my wireless Linksys IP camera which, although I bought several months ago, I hadn't taken my time to give the attention this beauty deserves until now! :)"><meta itemprop="description" content="During the easter break, I was playing with my my wireless Linksys IP camera which, although I bought several months ago, I hadn't taken my time to give the attention this beauty deserves until now! :)"><meta property="image" content="https://www.gnucitizen.org/files/2009/04/wizard_cam_discovery-300x225.png &quot;Wizard Cam Discovery&quot;"><meta itemprop="image" content="https://www.gnucitizen.org/files/2009/04/wizard_cam_discovery-300x225.png &quot;Wizard Cam Discovery&quot;"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/hacking-linksys-ip-cameras-pt-1/"><meta property="og:title" content="Hacking Linksys IP Cameras (pt 1)"><meta property="og:description" content="During the easter break, I was playing with my my wireless Linksys IP camera which, although I bought several months ago, I hadn't taken my time to give the attention this beauty deserves until now! :)"><meta property="og:image" content="https://www.gnucitizen.org/files/2009/04/wizard_cam_discovery-300x225.png &quot;Wizard Cam Discovery&quot;"><meta name="twitter:title" content="Hacking Linksys IP Cameras (pt 1)"><meta name="twitter:description" content="During the easter break, I was playing with my my wireless Linksys IP camera which, although I bought several months ago, I hadn't taken my time to give the attention this beauty deserves until now! :)"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://www.gnucitizen.org/files/2009/04/wizard_cam_discovery-300x225.png &quot;Wizard Cam Discovery&quot;"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"><h1><a href="/"></a></h1><p></p></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Hacking Linksys IP Cameras (pt 1)</h1><div>Mon, 20 Apr 2009 07:40:35 GMT</div><div id="post-content"><p>During the easter break, I was playing with my my wireless Linksys IP camera which, although I bought several months ago, I hadn&#39;t taken my time to give the attention this beauty deserves until now! :)</p>
<p>The model in particular is the <a href="http://www.linksysbycisco.com/US/en/products/WVC54GCA">WVC54GCA</a>, which I would say is one of the most affordable Wi-Fi IP cameras out there (about GBP 80 in the UK), making it a great toy to tinker with. I found the camera to be quite good functionalities-wise, although I&#39;ve experienced availability problems with it. It seems the camera freezes every once in a while. Well, this is true at least when you heavily customized its configuration which is what I&#39;ve ultimately done after playing so much with it.</p>
<p>I&#39;ve loved playing with embedded devices for a while, and as a security researcher I find it quite an interesting topic as many &quot;de facto&quot; security principles that are usually (attempted to be) followed when designing other types of systems are <em>not</em> often applied to embedded devices. This, I believe is due to lack of limitations in hardware resources, and lack of awareness on consequences of getting a miscellaneous device compromised. i.e.: &quot;who cares if my IP camera gets owned?&quot;</p>
<p><em>During the next days, I&#39;ll be posting some vulnerabilities I&#39;ve found. Some of them are fun and serious, while others you might find kind of boring</em>.</p>
<h3 id="meet-the-target">Meet the target</h3>
<p>You can learn a lot about the specs of a device by simply reading the product&#39;s literature. However, sometimes not enough info is provided in these documents. The following are some of the specs I confirmed by interacting with the camera in various ways:</p>
<ul>
<li>CPU: <code>Faraday FA526id(wb) rev 1 (v4l)</code> according to <code>/proc/cpuinfo</code></li>
<li>OS: <code>Linux version 2.4.19-pl1029</code> according to <code>/proc/version</code> plus Busybox (confirmed as the file <code>/bin/busybox</code> exists on the filesystem)</li>
<li>HTTPD: <code>thttpd 2.25b</code> (extracted from banner returned on default html error pages and &#39;Server:&#39; HTTP headers)</li>
<li>Memory: 30908kB (32 MB?) according to <code>/proc/meminfo</code></li>
<li>Firmware Version: V1.00R22 and <a href="http://downloads.linksysbycisco.com/downloads/WVC54GCA_FW_100R24,0.zip">V1.00R24</a> (latest version available as on 16th April 2009)</li>
</ul>
<p>It also comes with a telnet daemon (<code>/usr/sbin/telnetd</code>) but unfortunately for hackers out there, the daemon is disabled as the following line is commented out on <code>/etc/init.d/rcS</code>:</p>
<pre><code># ---- Start Telnet Server (debug) ---- #

#/usr/sbin/telnetd &amp;</code></pre><p>I have not yet managed to get a remote root shell by enabling the telnet daemon but have found some vulnerabilities which might help accomplishing this goal. I will be releasing these vulnerabilities in the next days. Please let me know if you know how to enable the telnet daemon on Linksys IP cameras! Ideally, I&#39;d like to accomplish this without physically connecting to the camera or flashing the firmware.</p>
<h3 id="remote-admin-compromise-by-unauthenticated-attackers-due-to-wizard-design-error">Remote admin compromise by unauthenticated attackers due to wizard design error</h3>
<p>I found this vulnerability while investigating <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4390">CVE-2008-4390</a>. I wanted to know if CVE-2008-4390 affected my camera, even though it was reported to affect a different Linksys IP camera firmware and model. The CVE entry states:</p>
<blockquote>
<p>The Cisco Linksys WVC54GC wireless video camera before firmware 1.25 sends cleartext configuration data in response to a Setup Wizard remote-management command, which allows remote attackers to obtain sensitive information such as passwords by sniffing the network.</p>
</blockquote>
<p>So I started trying to figure out if the WVC54GCA also discloses sensitive information when communicating with the <a href="http://downloads.linksysbycisco.com/downloads/WVC54GCA-CD-Content-10-25-2007_SetupWiz.zip">wizard</a>. <a href="http://www.kb.cert.org/vuls/id/MAPG-7HJKSA">According to the vendor</a>, the issue has been fixed:</p>
<blockquote>
<p>Solution: 2300 and 210 have encrypted data and have no such issue. To decode the data, an administrator username/password is a MUST.</p>
</blockquote>
<p>At first sight, when capturing the traffic between the wizard and the cam, I couldn&#39;t see the data traveling in human readable form. While trying to figure out how the data is sent over the network (i.e.: encoded/encrypted), I realized there was something seriously wrong with the handshake mechanism.</p>
<p>The following is a very generic (and possibly inaccurate) description of the handshake</p>
<ol>
<li>Wizard (<code>SetupWizard.exe</code>) sends UDP request to <code>255.255.255.255:916</code></li>
<li>Camera responds back to <code>255.255.255.255</code> using the <a href="http://en.wikipedia.org/wiki/DCE/RPC">DCERPC</a> protocol and presents itself with identity info such as the value of the <code>defname</code> variable which looks like <code>LKXXXXXX</code>, where <code>X</code> is a hex digit. This identity info is picked up by <code>SetupWizard.exe</code>. Some of this info such as MAC address, IP address and subnet mask is shown in the wizard.</li>
<li>From now on, <code>SetupWizard.exe</code> uses the camera&#39;s <code>defname</code> variable when talking to it, so that the camera knows what requests submitted to <code>255.255.255.255:916</code> it should respond to.</li>
</ol>
<p>At this point the wizard has discovered the camera and the user can go through the setup procedure. For security reasons, the user needs to enter the admin username and password, before the setup process can start. Otherwise anyone could make changes to the camera without authenticating.</p>
<p>Now, here is the important bit. If you capture the network traffic while running <code>SetupWizard.exe</code>, you&#39;ll notice that when the user is asked to enter the admin username and password after the camera is discovered, there are NO requests sent from the wizard to the camera in order to verify that the entered username/password combination is correct!</p>
<p>&quot;How is this possible? What the heck is going on?!&quot; I thought. I was terrified to confirm my worst fear: the wizard already knows the camera&#39;s admin username and password at this point, thus there is no need to ask the camera again. Indeed, at this point - <em>before the user enters the admin username and password</em> that is - the camera&#39;s credentials are already loaded into the memory of the <code>SetupWizard.exe</code> process. This is because the camera  has previously transfered the admin credentials along with other configuration data!</p>
<p>In case I didn&#39;t explain myself properly I&#39;ll summarize the issue by saying that the camera transfers the admin username and password to the wizard before the user enters them. The following steps demonstrate how an unauthenticated attacker can remotely obtain the camera&#39;s admin username and password:</p>
<ol>
<li>Download the <a href="http://downloads.linksysbycisco.com/downloads/WVC54GCA-CD-Content-10-25-2007_SetupWiz.zip">setup wizard</a>. You might need to download a different wizard if you want to test this vulnerability on a different Linksys IP camera model</li>
<li>Run <code>SetupWizard.exe</code></li>
<li>Click on <code>Click Here to Start / Setup Camera / Next</code> (after accepting EULA) / <code>Next</code> (4 more times in total)</li>
<li>The discovery process is quite flaky, so if the wizard hasn&#39;t found your camera yet, click on <code>Search Again</code> as many times as required until it works</li>
<li>You should now see your camera&#39;s name under the <code>Camera List</code> column and also various configuration data under the <code>Status</code> column:<div class="screen">![Wizard Cam Discovery](/files/2009/04/wizard_cam_discovery-300x225.png "Wizard Cam Discovery")</div></li>
<li>You now need to dump the process memory of <code>SetupWizard.exe</code> using your favorite <a href="http://www.ntsecurity.nu/toolbox/pmdump/">tool</a>:<div class="screen">![setupwizardexe Mem Dump 2](/files/2009/04/setupwizardexe_mem_dump_21-300x166.png "setupwizardexe Mem Dump 2")</div></li>
<li>Then open the memory dump file using your favorite <a href="http://www.chmaas.handshake.de/delphi/freeware/xvi32/xvi32.htm">hex editor</a></li>
<li>Now you can either search for <em>admin</em> and find the admin password after a few null bytes, or tell your hex editor to go to decimal position 75058 (<code>Address / Goto ...</code> menu on XVI32). In my case the admin password would always fall within this position:<div class="screen">![Admin Password Extraction 1](/files/2009/04/admin_password_extraction1-300x217.png "Admin Password Extraction 1")
![Admin Password Extraction 2](/files/2009/04/admin_password_extraction_2-300x216.png "Admin Password Extraction 2")</div></li>
<li>Have fun! (the most important step really)</li>
</ol>
<p>It is somehow ironic that a free tool provided by the vendor of a product can be used as a hacker tool against their own product.</p>
<p><em>As far as I know, this vulnerability cannot be exploited over the Internet, since the camera only responds to wizards located in the same LAN. Never say never though, so if you find a way to exploit this vulnerability over the Internet, please <a href="https://www.gnucitizen.org/contact/">contact</a> us.</em></p>
<p><strong>UPDATE</strong>: CPU and additional OS info added.</p>
</div><div id="post-comments"><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Tod"><span>Tod</span><div class="post-comment-content">Aw man, no pcap? Don't make me go out and buy one of these things just to see if I can't decode the handshake...</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="ZachR"><span>ZachR</span><div class="post-comment-content">Very nice. Keep up the great work!</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pagvac"><span>pagvac</span><div class="post-comment-content">@Tod: the only reason i didnt post the pcap file is because the handshake (whether truly encrypted or not) will include config data that's specific to my camera (i.e.: MAC address). call me paranoid, but i rather not post it. besides, these cameras are relatively affordable.

@ZachR: thanks for the nice comment :)</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="j-zero"><span>j-zero</span><div class="post-comment-content">yeah linksys. epic fail.</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="CERT"><span>CERT</span><div class="post-comment-content">http://www.kb.cert.org/vuls/id/528993

Old news</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pdp"><span>pdp</span><div class="post-comment-content">ahhhhhhh, r u sure this is the same vuln?</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Justin"><span>Justin</span><div class="post-comment-content">Ok I just ordered one to try this myself. justin@wastate.net</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pagvac"><span>pagvac</span><div class="post-comment-content">@CERT: the US-CERT note you mentioned (VU#528993) is the same as CVE-2008-4390 which I *did* talk about in this post. It might not be the same exact issue but it's hard to tell as there is very little info provided by CVE-2008-4390/VU#528993.

Please note that:

1) a different model (WVC54GC) was reported to be vulnerable on CVE-2008-4390/VU#528993

2) the data didn't seem to travel unencrypted in the case of the WVC54GCA during communications with the setup wizard (maybe just encoded/obfuscated?). VU#528993 mentions: "This packet is sent over the network unencrypted", which doesn't appear to be true for the WVC54GCA (at least at first sight, further digging might reveal otherwise)

3) there is no fix available for the WVC54GCA at time of writing, while Linksys did release a fix for the WVC54GC

I tried contacting Andre Protas and Greg Linares who found the issue you mentioned (CVE-2008-4390/VU#528993) in order to gather more details, but I received no response.

It might be possible that Linksys did fix the issue of sensitive data traveling in the clear when the wizard communicates with the camera, but might have still left unfixed a fundamental flaw: the camera sends the admin password to the wizard before the user even enters them on the wizard. I guess the developer(s) didn't think of someone examining the memory of the wizard process?</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="shawnmer"><span>shawnmer</span><div class="post-comment-content">Looks like the Linksys Setup utility has been pullled from the link you provided above: WVC54GCA-CD-Content-10-25-2007_SetupWiz.zip</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pagvac"><span>pagvac</span><div class="post-comment-content">@shawnmer: Linksys updated the wizard URL. The new link is http://downloads.linksysbycisco.com/downloads/WVC54GCA-CD-Content-10-25-2007_SetupWiz,0.zip

FYI:

<pre><code>$ md5sum SetupWizard.exe 
1c7cb77e906152376102b88604650577  SetupWizard.exe</code></pre></div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="---"><span>---</span><div class="post-comment-content">Has anyone tried to sniff and playback the video stream (probably mpeg4) of these IP cameras?</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Wayland"><span>Wayland</span><div class="post-comment-content">I can confirm that the camera does lock up on occasion but clears itself and it's light sensitivity is not as good as a Sitecom Wifi camera. However it's an excellent price and works very well with Go1984. 

It would be interesting to turn a router or a print server into a mini USB camera server.</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="rmadeat"><span>rmadeat</span><div class="post-comment-content">Very nice. 

Thank you</div></div><div class="post-comment"><img src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="william c"><span>william c</span><div class="post-comment-content">if its running linux why hasn't anyone written a replacement os like dd-wrt for the routers. the cameras credentials for the plugin are out of date so the only way to view it with out the pc software is to make your browser vulnerably to unsigned content. so why doesnt some code genius do just that and write a more updated os for the camera i mean look what dd-wrt did for the wrt54g</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2019 <a href=""></a>. All rights reserved.</p></footer></body></html>