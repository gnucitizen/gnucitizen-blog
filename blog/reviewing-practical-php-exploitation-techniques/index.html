<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Reviewing Practical PHP Exploitation Techniques</title><meta name="description" content="The OWASP London Chapter last night (03/Apr/08) was excellent. Thanks to everyone involved for a top night!"><meta property="name" content="Reviewing Practical PHP Exploitation Techniques"><meta itemprop="name" content="Reviewing Practical PHP Exploitation Techniques"><meta property="description" content="The OWASP London Chapter last night (03/Apr/08) was excellent. Thanks to everyone involved for a top night!"><meta itemprop="description" content="The OWASP London Chapter last night (03/Apr/08) was excellent. Thanks to everyone involved for a top night!"><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Freviewing-practical-php-exploitation-techniques%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Freviewing-practical-php-exploitation-techniques%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/reviewing-practical-php-exploitation-techniques/"><meta property="og:title" content="Reviewing Practical PHP Exploitation Techniques"><meta property="og:description" content="The OWASP London Chapter last night (03/Apr/08) was excellent. Thanks to everyone involved for a top night!"><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Freviewing-practical-php-exploitation-techniques%2F?w=1024"><meta name="twitter:title" content="Reviewing Practical PHP Exploitation Techniques"><meta name="twitter:description" content="The OWASP London Chapter last night (03/Apr/08) was excellent. Thanks to everyone involved for a top night!"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Freviewing-practical-php-exploitation-techniques%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Reviewing Practical PHP Exploitation Techniques</h1><div class="date">Fri, 04 Apr 2008 10:22:20 GMT</div><div class="author">by
david-kierznowski</div><div id="post-content"><p>The OWASP London Chapter last night (03/Apr/08) was excellent. Thanks to everyone involved for a top night!</p>
<ul>
<li>For those who didn&#39;t attend, <strong>Rodrigo Marcos</strong> discussed his research on hacking PHP sockets for fun and profit. I found the concept very interesting. He discussed hacking PHP sockets; however, the techniques he discusses could be used as an application reverse proxy, although, scalability and stability could be a problem.</li>
<li><strong>David Kierznowski (myself)</strong> gave a talk on practical PHP exploitation techniques using real world examples. I think we scared some of the guys from a certain university who recognised real world vulnerable code in their own applications :)</li>
<li><strong>Colin Watson</strong> opened a can of worms in his discussion of security badges (Hacker Safe, Hacker proof etc). We had a good discussion on this!</li>
</ul>
<p>I have uploaded my <a href="/files/2008/04/php-code-analysis-real-world-examples.pdf">presentation</a> to my site. I spent a lot of time trying to get good screenshots, so I hope it makes it easy to follow for those who couldn&#39;t attend.</p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/1d95d2324345e3dd2e41d6066cc1b492?s=256&amp;d=retro" alt="David Kierznowski"><span class="post-comment-author">David Kierznowski</span><div class="post-comment-content">Hugo sent me an interesting point regarding the urldecode() attack. I mentioned that urldecode would change <code>%2527</code> to <code>% + 27</code>.

<blockquote>Hugo: The Webserver will change %25 to %, and then urldecode() will change %27 to "'".</blockquote>

Lets try this out:

<pre><code>$a = $_GET['t'];

    echo $a; // before urldecode
    $b = urldecode($a);
    echo $b; // after urldecode

We get from t=%25 | t=%:
    $a = %
    $b = % // no change</code></pre>

Thanks for the observation Hugo. 

While we are on the subject of <code>urldecode()</code>. <code>urldecode()</code> is also vulnerable to NULL byte injection. So there is certainly potential for other vulnerabilities such as File Include bugs (<code>%2500</code>).</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/5e0f595cbc8f1811233adce10ac6c5d3?s=256&amp;d=retro" alt="Awesome AnDrEw"><span class="post-comment-author">Awesome AnDrEw</span><div class="post-comment-content">Correct me if I'm wrong, David, since I am in no way an expert in PHP, but nullbytes can easily be detected with preg_match and preg_match_all assuming they are in a Hex-encoded string, right? I've experimented with it a bit in the past, and always found it work in my test cases.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/d5336d69ae0d217a290061546069991b?s=256&amp;d=retro" alt="Gustavo Cardial"><span class="post-comment-author">Gustavo Cardial</span><div class="post-comment-content">Very nice, I'll check it out! Also, if you know where to find the php sockets presentation, please, let me know</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/38ae4d6871eaa03293d6fcaba765bb41?s=256&amp;d=retro" alt="Joey"><span class="post-comment-author">Joey</span><div class="post-comment-content">Thanks for publishing your presentation David. Always good to have more documented vulnerabilities (and their solutions) to keep newly built applications on top of them.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/43c7e8b930c2f649e8f866fc336a095e?s=256&amp;d=retro" alt="hadaka-sarutobi"><span class="post-comment-author">hadaka-sarutobi</span><div class="post-comment-content">Can you elaborate more on multi-byte encoding attacks and how one attacks/defends them?</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/7cedb843eb2922000eb41b4561ed660d?s=256&amp;d=retro" alt="mike"><span class="post-comment-author">mike</span><div class="post-comment-content">Wow,  its cool to see some CVE's instead of just theory.   I am not saying that I don't enjoy theory. 

urldecode() isn't the only way to bypass filtering.  I used base64_decode() here to bypass magic_quotes_gpc to hit some nifty SQL injection.  The SQL payload I used is a bit different from the norm. http://milw0rm.com/exploits/4733

Also EVERY file function in php suffers from a null byte issue because they are all calling the same C file handling function,  go ahead look at the stack trace in GDB.   To be honest as a C programmer I'm horrified some functions will read past the null byte. 

Peace</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/1d95d2324345e3dd2e41d6066cc1b492?s=256&amp;d=retro" alt="David Kierznowski"><span class="post-comment-author">David Kierznowski</span><div class="post-comment-content">Awesome AnDrEw, as far as I know, I think this is one way to handle NULL bytes.

hadaka, I could probably do a seperate presentation on that topic. See Awesome AnDrEw's comment.

mike, cool stuff man. Keep up the good work.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/b151117078db57b824b1f6710d791db1?s=256&amp;d=retro" alt="Viz"><span class="post-comment-author">Viz</span><div class="post-comment-content">There is an issue on slide 12 with 

<pre><code>POST http://192.168.1.4/t/xoops-2.0.14/htdocs/install/index.php HTTP/1.1
lang=../../../../../../../../etc/passwd%00&op=start&submit=Next</pre></code>

<blockquote>NOTE: This attack will not work if MAGIC QUOTES are enabled. MAGIC
QUOTES escapes null characters to . This feature is often forgotten about.</blockquote>

magic quotes is deprecated and will be going completely away with php 6. Advising people to use it is setting them up for trouble.

per the manual: http://www.php.net/manual/en/security.magicquotes.php

<blockquote>Warning

This feature has been DEPRECATED and REMOVED as of PHP 6.0.0. Relying on this feature is highly discouraged.</blockquote>

As well it's inconsistent and doesn't always work. They are removing it because they've realized you can't create defensive coding with a language option that only works half the time. It simply doesn't work. A far better solution to the include problem is to compare the input variable and switch on it:

<pre><code>$var=$_GET['language'];
switch($var)
{
  case "english":
    $include='english.php';
    break;
  case "spanish":
    $include='spanish.php';
    break;
  default:
    $include='genericerror.php';
    //or even 'english.php'
}</code></pre>

You could also set up an associative array of include directories and do an array reference using $var as the index to locate a path or something. If the value at that index is empty (unexpected/malicious input) use the safety include. Using input directly, no matter how it's filtered, to build a path is very very bad form. Always has been. I've lost track (I'm sure you have too 8) of the number of vulnerabilities caused by this type of stupidity. As well, you can use a whitelist filter on your input to remove things like null. eg:

<pre><code>$inputvar=$_GET['inputvar'];
$inputvar=preg_replace("/^[\w\.\@]/","",$inputvar);
(remove all but a-z,A-Z,0-9, . and @)</code></pre>

Trying to filter all the bad stuff out is a losing proposition, much better to *only allow the good stuff*. It's future proof.

Great article!!!

-Viz</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2022 <a href=""></a>. All rights reserved.</p></footer></body></html>