<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Snippets Of Defense Pt.IV</title><meta name="description" content="This article is part of a series of posts about small and easy to understand code fragments you can use on your site for protection against certain kinds of attacks. Also this series is targeted to help you understand better what tricks are used by attackers to break into your site and how to avert them. If you have a Snippet of defense yourself and you want to share it, feel free to contact us. Self-defense with a walking-stick."><meta property="name" content="Snippets Of Defense Pt.IV"><meta itemprop="name" content="Snippets Of Defense Pt.IV"><meta property="description" content="This article is part of a series of posts about small and easy to understand code fragments you can use on your site for protection against certain kinds of attacks. Also this series is targeted to help you understand better what tricks are used by attackers to break into your site and how to avert them. If you have a Snippet of defense yourself and you want to share it, feel free to contact us. Self-defense with a walking-stick."><meta itemprop="description" content="This article is part of a series of posts about small and easy to understand code fragments you can use on your site for protection against certain kinds of attacks. Also this series is targeted to help you understand better what tricks are used by attackers to break into your site and how to avert them. If you have a Snippet of defense yourself and you want to share it, feel free to contact us. Self-defense with a walking-stick."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fsnippets-of-defense-ptiv%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fsnippets-of-defense-ptiv%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/snippets-of-defense-ptiv/"><meta property="og:title" content="Snippets Of Defense Pt.IV"><meta property="og:description" content="This article is part of a series of posts about small and easy to understand code fragments you can use on your site for protection against certain kinds of attacks. Also this series is targeted to help you understand better what tricks are used by attackers to break into your site and how to avert them. If you have a Snippet of defense yourself and you want to share it, feel free to contact us. Self-defense with a walking-stick."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fsnippets-of-defense-ptiv%2F?w=1024"><meta name="twitter:title" content="Snippets Of Defense Pt.IV"><meta name="twitter:description" content="This article is part of a series of posts about small and easy to understand code fragments you can use on your site for protection against certain kinds of attacks. Also this series is targeted to help you understand better what tricks are used by attackers to break into your site and how to avert them. If you have a Snippet of defense yourself and you want to share it, feel free to contact us. Self-defense with a walking-stick."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fsnippets-of-defense-ptiv%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"><h1><a href="/"></a></h1><p></p></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Snippets Of Defense Pt.IV</h1><div class="date">Wed, 31 Oct 2007 10:41:28 GMT</div><div class="author">by mario-heiderich</div><div id="post-content"><p>This article is part of a series of posts about small and easy to understand code fragments you can use on your site for protection against certain kinds of attacks. Also this series is targeted to help you understand better what tricks are used by attackers to break into your site and how to avert them. If you have a Snippet of defense yourself and you want to share it, feel free to <a href="http://www.gnucitizen.org/contact">contact us</a>. Self-defense with a walking-stick.</p>
<h3 id="the-snippet-mysterious-characters-from-the-unicode-world">The snippet - mysterious characters from the Unicode world</h3>
<p>Most of our readers know to one degree or another about character sets, UTF and Unicode, but what some of you don&#39;t know is the fact that there are several characters that can really harm you online estate and slip through most, if not all, filters. Those are to be categorized into two groups - the numerous variation of <a href="http://www.cs.tut.fi/~jkorpela/chars/spaces.html">Unicode whitespace</a> characters and the characters that change the direction of the displayed text (<a href="http://en.wikipedia.org/wiki/Left_to_right">LTR, RTL</a>). While doing some JavaScript research I&#39;ve created a loop to check what characters can be put in between arbitrary method calls, without stopping the method from executing. Just like that:</p>
<pre><code>win**[unicode]**dow.ale**[unicode]**rt**[unicode]**(1);</code></pre><p>I used several loops to determine the existence and the exact place in the Unicode table of those characters - tested in <a href="https://addons.mozilla.org/de/firefox/addon/1843">Firebug</a>:</p>
<pre><code class="language-xml">var i =0;
var j = String.fromCharCode
while(i <span class="tag">&lt; <span class="attr">65536</span>) {<span class="attr">try</span>{<span class="attr">eval</span>('<span class="attr">con</span>'+<span class="attr">j</span>(<span class="attr">i</span>)+'<span class="attr">sole.log</span>("&amp;#'+<span class="attr">i</span>+' '+<span class="attr">j</span>(<span class="attr">i</span>)+'")');} <span class="attr">catch</span>(<span class="attr">e</span>) {}<span class="attr">i</span>++}</span></code></pre>
<p>The result was surprising - as you can see yourself, there is a whole bunch of characters that can be placed right between method and property names. So, I tried those characters with the <a href="http://demo.php-ids.org/">PHPIDS Demo</a> and boom - the filter rules were evaded with ease. So I began crafting a solution for this problem and I came up with the following:</p>
<pre><code class="language-php">$value = rawurldecode(preg_replace(<span class="string">'/(?:%E(?:2|3)%8(?:0|1)%(?:A|8|9)\w|%EF%BB%BF)/i'</span>, <span class="string">' '</span>, rawurlencode($value)));</code></pre>
<p>You can use this code in your PHP application to make sure any of those pretty dangerous characters will be transformed into a regular space. Feel free to try on your application what characters like <strong>&amp;#8238</strong> and others can do to your site - this is the kind of defense measurement you don&#39;t want to miss.</p>
<p><strong>&#8238;Or just take a look at this line of text ;)</strong></p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/bd8ac47a2a650bc3add0502686f33e39?s=256&amp;d=retro" alt="seraph"><span class="post-comment-author">seraph</span><div class="post-comment-content">pdp, I do not intend to sound ignorant, but wouldn't this also e bypassed if you simply declare a character encoding in your meta tags?

Please shed some light.</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2020 <a href=""></a>. All rights reserved.</p></footer></body></html>