<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Strategic GeoIP Hacking and TV Streaming Theft</title><meta name="description" content="A couple of weeks ago, my wife pointed out to me this really cool appliance she saw on a magazine. Since she knows I like spending my free time hacking/researching embedded devices, she thought I'd be interested."><meta property="name" content="Strategic GeoIP Hacking and TV Streaming Theft"><meta itemprop="name" content="Strategic GeoIP Hacking and TV Streaming Theft"><meta property="description" content="A couple of weeks ago, my wife pointed out to me this really cool appliance she saw on a magazine. Since she knows I like spending my free time hacking/researching embedded devices, she thought I'd be interested."><meta itemprop="description" content="A couple of weeks ago, my wife pointed out to me this really cool appliance she saw on a magazine. Since she knows I like spending my free time hacking/researching embedded devices, she thought I'd be interested."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fstrategic-geoip-hacking-and-tv-streaming-theft%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fstrategic-geoip-hacking-and-tv-streaming-theft%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/strategic-geoip-hacking-and-tv-streaming-theft/"><meta property="og:title" content="Strategic GeoIP Hacking and TV Streaming Theft"><meta property="og:description" content="A couple of weeks ago, my wife pointed out to me this really cool appliance she saw on a magazine. Since she knows I like spending my free time hacking/researching embedded devices, she thought I'd be interested."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fstrategic-geoip-hacking-and-tv-streaming-theft%2F?w=1024"><meta name="twitter:title" content="Strategic GeoIP Hacking and TV Streaming Theft"><meta name="twitter:description" content="A couple of weeks ago, my wife pointed out to me this really cool appliance she saw on a magazine. Since she knows I like spending my free time hacking/researching embedded devices, she thought I'd be interested."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fstrategic-geoip-hacking-and-tv-streaming-theft%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"><h1><a href="/"></a></h1><p></p></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Strategic GeoIP Hacking and TV Streaming Theft</h1><div class="date">Fri, 16 Nov 2007 14:22:00 GMT</div><div class="author">by pagvac</div><div id="post-content"><p>A couple of weeks ago, my wife pointed out to me this really <a href="http://www.cnettv.com/9742-1_53-27769.html">cool appliance</a> she saw on a magazine. Since she knows I like spending my free time hacking/researching embedded devices, she thought I&#39;d be interested.</p>
<p>In summary, you hookup <a href="http://www.slingmedia.com/go/slingbox">Slingbox</a> to your TV box, be it digital TV, or cable. Then you can do streaming to your laptop, desktop computer or even mobile/cell phone. The best thing is that not only you can stream within your home (LAN) network, but also from the Internet, anywhere any time! Of course you would need to setup port-forwarding on your border router to accomplish this first. Don&#39;t be fooled and think that only geeks would enable such setups because of its difficulty. Truth is, SlingPlayer (the client), will help you automatically enable port-forwarding on your router through a easy-to-use wizard (which uses UPnP in the background to talk to your router, in case you are interested). Never the less there are also instructions to <a href="http://support.slingmedia.com/page/remote-viewing-tutorials">setup remote viewing manually</a>.</p>
<p>After researching the device a bit, I learned that all you need is install the client called SlingPlayer. In order to receive the video stream, a connection is established to port 5001 on the appliance, and then you just authenticate with a username/password combination. As you can see it&#39;s a very standard client-to-server setup!</p>
<p>Most people that setup port-forwarding on their router to their Slingbox would forward port 5001 from their router to port 5001 on the Slingbox, simply because this is how the documentation available shows users how to manually setup <a href="http://support.slingmedia.com/go/remote-viewing">remote viewing</a> to their Slingboxes&#39; video stream. SlingPlayer&#39;s can also be used to enable port-forwarding on such port by following an automatic wizard which is perfect for non-technical users. Cutting the story short, the target port to find Slingboxes on the Internet would be 5001.</p>
<p>Imagine someone found an authentication bypass bug. Or maybe, most users leave default credentials on. There is potential for stealing TV services. This of course doesn&#39;t only apply to this device but many others that are in charge of services such as TV streaming, VoIP telephony, etc ... How would a cracker come about finding these boxes on the Internet? Well, from a GeoIP hacking point of view, step number one would be to find the countries with Slingbox users. By browsing slingmedia.com, you learn that the device is available for the USA, UK, Canada and the Netherlands.</p>
<p>pdp <a href="/blog/strategic-hacking-geoip">wrote</a> a script (do.sh) that downloads Maxmind&#39;s <a href="http://www.maxmind.com/download/geoip/database/http://www.maxmind.com/download/geoip/database/">free GeoIP database</a> and parses the IP ranges of all countries - sweet! The end result is a file with IP ranges using the following format which separates the start IP and end IP with a coma ( , ) : <code>X.X.X.X,X.X.X.X</code>. The problem is that this notation is not compatible with nmap. Since what we want is scan countries with Slingboxes for port 5001, we need to convert the IP ranges to a notation that can be understood by nmap, which can be done with the following script.</p>
<pre><code class="language-bash"><span class="meta">#!/bin/bash</span>
<span class="comment"># iprange2nmaprange.sh</span>

<span class="comment"># just change the following line to match the country csv file you want to convert</span>
<span class="keyword">for</span> i <span class="keyword">in</span> `cat country-XX.csv`
<span class="keyword">do</span>
        startIP=`<span class="built_in">echo</span> <span class="variable">$i</span> | cut -d <span class="string">','</span> -f 1`
        endIP=`<span class="built_in">echo</span> <span class="variable">$i</span> | cut -d <span class="string">','</span> -f 2`

        startA=`<span class="built_in">echo</span> <span class="variable">$startIP</span> | cut -d <span class="string">'.'</span> -f 1`
        startB=`<span class="built_in">echo</span> <span class="variable">$startIP</span> | cut -d <span class="string">'.'</span> -f 2`
        startC=`<span class="built_in">echo</span> <span class="variable">$startIP</span> | cut -d <span class="string">'.'</span> -f 3`
        startD=`<span class="built_in">echo</span> <span class="variable">$startIP</span> | cut -d <span class="string">'.'</span> -f 4`
        <span class="comment">#echo $startA $startB $startC $startD</span>

        endA=`<span class="built_in">echo</span> <span class="variable">$endIP</span> | cut -d <span class="string">'.'</span> -f 1`
        endB=`<span class="built_in">echo</span> <span class="variable">$endIP</span> | cut -d <span class="string">'.'</span> -f 2`
        endC=`<span class="built_in">echo</span> <span class="variable">$endIP</span> | cut -d <span class="string">'.'</span> -f 3`
        endD=`<span class="built_in">echo</span> <span class="variable">$endIP</span> | cut -d <span class="string">'.'</span> -f 4`
        <span class="comment">#echo $endA $endB $endC $endD</span>

        <span class="keyword">if</span> [ <span class="variable">$startA</span> -eq <span class="variable">$endA</span> ]
        <span class="keyword">then</span>
                nmapA=<span class="variable">$startA</span>
        <span class="keyword">else</span>
                nmapA=<span class="string">"<span class="variable">$startA</span>-<span class="variable">$endA</span>"</span>
        <span class="keyword">fi</span>

        <span class="keyword">if</span> [ <span class="variable">$startB</span> -eq <span class="variable">$endB</span> ]
        <span class="keyword">then</span>
                nmapB=<span class="variable">$startB</span>
        <span class="keyword">else</span>
                nmapB=<span class="string">"<span class="variable">$startB</span>-<span class="variable">$endB</span>"</span>
        <span class="keyword">fi</span>

        <span class="keyword">if</span> [ <span class="variable">$startC</span> -eq <span class="variable">$endC</span> ]
        <span class="keyword">then</span>
                nmapC=<span class="variable">$startC</span>
        <span class="keyword">else</span>
                nmapC=<span class="string">"<span class="variable">$startC</span>-<span class="variable">$endC</span>"</span>
        <span class="keyword">fi</span>

        <span class="keyword">if</span> [ <span class="variable">$startD</span> -eq <span class="variable">$endD</span> ]
        <span class="keyword">then</span>
                nmapD=<span class="variable">$startD</span>
        <span class="keyword">else</span>
                nmapD=<span class="string">"<span class="variable">$startD</span>-<span class="variable">$endD</span>"</span>
        <span class="keyword">fi</span>

        <span class="built_in">echo</span> <span class="string">"<span class="variable">$nmapA</span>.<span class="variable">$nmapB</span>.<span class="variable">$nmapC</span>.<span class="variable">$nmapD</span>"</span>
<span class="keyword">done</span></code></pre>
<pre><code>./test.sh &gt; targets</code></pre><p>In this case we&#39;re interested in the files <code>country-US.csv</code>, <code>country-GB.csv</code>, <code>country-CA.csv</code> and <code>country-NL.csv</code>. Once converted to nmap IP range notation with the previous script we&#39;re ready to go:</p>
<pre><code>nmap -P0 -n -iL targets -p5001 -oG results</code></pre><p>Everything is turning to TCP/IP these days. Not only consumer devices, but also corporate and governmental appliances. Although this approach makes it cheaper to build products by reusing existing implementations/frameworks/APIs, there is a price to pay: it makes it easier for people (including bad guys) to perform vulnerability research, since TCP/IP is widely understood.</p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Jason Macpherson"><span class="post-comment-author">Jason Macpherson</span><div class="post-comment-content">Nmap tends to be a little slow for large scans like this.  You'll get your results much faster if you used scanrand.  

http://www.doxpara.com/read.php/code/paketto.html</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Zeryl"><span class="post-comment-author">Zeryl</span><div class="post-comment-content">I re-wrote the shell script for this, in PHP.  It does all of the .csv's created from the other script, at once, and extremely quickly (about 5 seconds on a dual P3). Below is the code for it:

<pre><code>&lt;?php

//Look through the local directory for *.csv
foreach (glob("*.csv") as $filename) {
    //Load the current file into the $lines array
    $lines = file($filename);
    
    $content = '';

    foreach($lines as $line)
    {
        //Explode the start and end ip from the current line
        list($startIP, $endIP) = explode(',', $line);
        
        //Explode each octet of the current ip into arrays
        $start = explode('.', $startIP);
        $end   = explode('.', $endIP);
        
        //Parse each array for the ip
        for($i = 0; $i&lt;=3; $i++)
        {
            if($start[$i] == $end[$i])
            {
                $nmap[$i] = $start[$i];
            }
            else {
                $nmap[$i] = "$start[$i]-$end[$i]";
            }
        }
        
        //Write the current namp'ified IP to the variable
        $content .= "$nmap[0].$nmap[1].$nmap[2].$nmap[3]\r\n";
    }
    
    //replace the extension with target
    $newfile = str_replace('csv', 'target', $filename);
    
    //write the file
    $size = file_put_contents($newfile, $content);
    echo("Wrote $newfile with a size of $size&lt;br /&gt;\r\n");    
}</code></pre></div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Adrian Pastor"><span class="post-comment-author">Adrian Pastor</span><div class="post-comment-content">Hey Jason! I will try Scanrand when I have time. I've also been wanting to play with Unicorn http://www.unicornscan.org/ for a while!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="LordDoskias"><span class="post-comment-author">LordDoskias</span><div class="post-comment-content">I think that "tcp/ip is widely understood" isn't a good argument. History has shown that "security through obscurity" doesn't work well. If tomorrow's technology is not tcp/ip or something else. Then it's a matter of time before someone document this technology. For example - "Silver needle in the skype" presented at BH '06. And skype is thought to be one of the most "hidden" technologies out there.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="hackathology"><span class="post-comment-author">hackathology</span><div class="post-comment-content">unicornscan is the way to go</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Dominik"><span class="post-comment-author">Dominik</span><div class="post-comment-content">My personal experience has been that scanrand is indeed fast, but also misses quite some open ports.

Yes, nmap _will_ run very slow with the provided command line. But you can speed it up quite a bit. First, scanning with -P0 is dead slow, because nmap has no round-trip-time information without a ping first, and will default to a slow scan mode. Second, nmap has a not-so-well documented fast single port scan mode. Third, you can speed things up by setting less conservative timing limits

An updated nmap command line would be: <code>nmap -PS5001 -S5 -n -iL targets -p5001 -oG results</code></div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Dominik"><span class="post-comment-author">Dominik</span><div class="post-comment-content">Sorry, just made a typo. It should read -T5 and not -S5</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="br4inmatic"><span class="post-comment-author">br4inmatic</span><div class="post-comment-content"><code>nmap -PS5001 -S5 -n -iL targets -p5001 -oG results</code> yeah.. that's really make it much faster.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Adrian Pastor"><span class="post-comment-author">Adrian Pastor</span><div class="post-comment-content">@LordDoskias - I agree that security through obscurity is not the way to go. However, we all are in a comfort zone, and that is highly reflected in public security research. btw, I will check out "Silver needle in the skype" :-)

Nice nmap tips guys! I was familiar with the timing -T flags, but not the -PS flag.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="maze"><span class="post-comment-author">maze</span><div class="post-comment-content">anyone got an idea on how the auth works? im trying to get a brute forcer goin...</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Adrian Pastor"><span class="post-comment-author">Adrian Pastor</span><div class="post-comment-content">@maze - Just run Wireshark while you try to authenticate with SlingPlayer. You can use the following filter on Wireshark: <code>ip.dst==targetIPaddress</code></div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="sean"><span class="post-comment-author">sean</span><div class="post-comment-content">Very interesting article. However, how do you handle the password part ? I understand you can designate a slingbox by its IP address, but how would you hack the password?

Thanks</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="NerdBert"><span class="post-comment-author">NerdBert</span><div class="post-comment-content">I used a Slingbox for a while but ended up ditching it. Nowadays internet speeds are so fast that I can access TV via the internet.  I'm in Europe, so I use a VPN service to connect to either the US or UK (VPN gives me a local IP address, thus working around the outside the "US/UK" country blocking). Three of the best sites are Hulu, SeeSaw and BBC iPlayer.

Here is a good updated list of the US/UK TV networks with free internet streaming http://www.vpntelevision.com Good luck in your quest for TV online!

Uncle Abe</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2020 <a href=""></a>. All rights reserved.</p></footer></body></html>