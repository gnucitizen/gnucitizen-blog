<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Hijacking Innocent Frames</title><meta name="description" content="Magic tricks are all about suggestion, psychology, misdirection and showmanship (see Tricks of the Mind), or as Cutter) perhaps will say, every magic trick has tree parts: the pledge (where the magician shows you something ordinary), the turn (where the ordinary becomes something extraordinary), and the prestige (where the extraordinary turns into something you have never seen before)."><meta property="name" content="Hijacking Innocent Frames"><meta itemprop="name" content="Hijacking Innocent Frames"><meta property="description" content="Magic tricks are all about suggestion, psychology, misdirection and showmanship (see Tricks of the Mind), or as Cutter) perhaps will say, every magic trick has tree parts: the pledge (where the magician shows you something ordinary), the turn (where the ordinary becomes something extraordinary), and the prestige (where the extraordinary turns into something you have never seen before)."><meta itemprop="description" content="Magic tricks are all about suggestion, psychology, misdirection and showmanship (see Tricks of the Mind), or as Cutter) perhaps will say, every magic trick has tree parts: the pledge (where the magician shows you something ordinary), the turn (where the ordinary becomes something extraordinary), and the prestige (where the extraordinary turns into something you have never seen before)."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fhijacking-innocent-frames%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fhijacking-innocent-frames%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/hijacking-innocent-frames/"><meta property="og:title" content="Hijacking Innocent Frames"><meta property="og:description" content="Magic tricks are all about suggestion, psychology, misdirection and showmanship (see Tricks of the Mind), or as Cutter) perhaps will say, every magic trick has tree parts: the pledge (where the magician shows you something ordinary), the turn (where the ordinary becomes something extraordinary), and the prestige (where the extraordinary turns into something you have never seen before)."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fhijacking-innocent-frames%2F?w=1024"><meta name="twitter:title" content="Hijacking Innocent Frames"><meta name="twitter:description" content="Magic tricks are all about suggestion, psychology, misdirection and showmanship (see Tricks of the Mind), or as Cutter) perhaps will say, every magic trick has tree parts: the pledge (where the magician shows you something ordinary), the turn (where the ordinary becomes something extraordinary), and the prestige (where the extraordinary turns into something you have never seen before)."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fhijacking-innocent-frames%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Hijacking Innocent Frames</h1><div class="date">Thu, 11 Dec 2008 21:39:16 GMT</div><div class="author">by
<a href="/members/pdp.html">pdp</a></div><div id="post-content"><p>Magic tricks are all about suggestion, psychology, misdirection and showmanship (see <a href="http://www.amazon.co.uk/Tricks-Mind-Derren-Brown/dp/1905026269">Tricks of the Mind</a>), or as <a href="http://en.wikipedia.org/wiki/The_Prestige_(film)">Cutter</a> perhaps will say, every magic trick has tree parts: the pledge (where the magician shows you something ordinary), the turn (where the ordinary becomes something extraordinary), and the prestige (where the extraordinary turns into something you have never seen before).</p>
<p>In a similar way, real world information security breaches are combination of the characteristics you will often find in the performance of skillful magicians. Therefore, allow me introduce you to a simplistic form of an attack, perhaps so simple that in fact it may work far more often than we would like to admit, which skillfully uses suggestion, psychology, misdirection and a great doze of showmanship.</p>
<p>So, we&#39;ve all heard of <a href="/blog/even-more-advanced-clickjacking/">clickjacking</a> and we know that it is a design bug and therefore it is very hard to deal with. However, are there other flawed areas of modern browsers design which can be abused? Of course there are. It just takes time to find them all because they are often well hidden underneath our common believes, ignorance and prejudice. Here is some code:</p>
<pre><code class="language-html"><span class="tag">&lt;<span class="name">html</span>&gt;</span>
    <span class="tag">&lt;<span class="name">body</span>&gt;</span>
        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">
            <span class="function"><span class="keyword">function</span> <span class="title">clickme</span>(<span class="params"></span>) </span>{
                <span class="keyword">var</span> w = <span class="built_in">window</span>.open(<span class="string">'http://www.google.com'</span>);

                setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>{
                    w.location = <span class="string">'http://www.gnucitizen.org'</span>;
                }, <span class="number">5000</span>);
            }
        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>
        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">"click me"</span> <span class="attr">onclick</span>=<span class="string">"clickme(this)"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="name">body</span>&gt;</span>
<span class="tag">&lt;/<span class="name">html</span>&gt;</span></code></pre>
<p>&quot;Quite boring! I agree.&quot; First of all the user clicks on a button/link. Then a new tab/window opens which loads the content of <code>http://www.google.com</code>. Five seconds later, the newly created tab is preloaded with the content of <code>http://www.gnucitizen.org</code>. Do you find this code disturbing? I do. It is disturbing because it breaks the trust relationship that is going on between the user and <code>google.com</code> in this specific <a href="https://chatbotkit.com/examples">example</a>. Call it <strong>surfjacking</strong>, <strong>framejacking</strong>, <strong>tabjacking</strong> or whatever you want to call it, but at the end of the day, I believe that this is just yet another form of bad design.</p>
<p>Here is another example. You browse the web, you click to digg a story, you get redirected to <code>digg.com</code> to login. SSL looks fine. The browser lights up all green. It is OK to type your username/password and you do. In the background, the page which initially took you to <code>digg.com</code> waits for you to login. It subsequently queries the <code>digg.com</code> login page for changes in the DOM structure by using script tags and error handlers to capture different error code offsets (check <a href="/blog/attackapi">AttackAPI</a>), and as such it tries to detect when you are fully logged on. It does these checks every half a second. Once a successful login is detected, it simply fires <code>w.location = &quot;some evil url here&quot;;</code> which will force the browser to render something else, perhaps something malicious, instead of the page that should have came after a successful authentication. Perhaps, the evil caller could even fire just a simple <code>alert(&#39;Hey there!&#39;);</code> message as a form of misdirection and than return back the control with another <code>w.focus()</code>.</p>
<p>Would you check the address bar again? Perhaps not, because the page which was forced onto you now contains similarly looking <code>digg.com</code> login page accompanied with some red and quite scary looking text which tells you that your login was unsuccessful. This is the psychology. The attacker uses the red color to distract your from the address bar so that you put all of your attention into the login form. You cannot escape your instincts. The forms screams at you that all you have to do is to fill in your username and password and everything will be fine again. You rush to fill in your credentials again. Your request is recorded. A 302 redirect fires back and the browser redirects you to your <code>digg.com</code> account like nothing has ever happened. This is the prestige.</p>
<p>As far as I know, although I might be wrong, this form of an attack is <strong>new</strong>. It is definitely not devastating and it wont break the Web. However, my honest opinion is that it does break a lot of things. For example, it breaks the user&#39;s normal surfing experience. The good news is that there is an easy fix. Simply put, do not allow pages to redirect windows which are preloaded with content from a different origin! We fix this, we save the Web again.</p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/bca2204daa687abf6e3963108ff5dc97?s=256&amp;d=retro" alt="rwnin"><span class="post-comment-author">rwnin</span><div class="post-comment-content">i bet someone will call it a feature ;)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c6fe4b4afb6c32a931f3d361d6305497?s=256&amp;d=retro" alt="holiman"><span class="post-comment-author">holiman</span><div class="post-comment-content">Good point, nice hack and solution that sounds like something that should have been a reasoable rule from the beginning. 

Regarding the AttachAPI and detecting signatures to check if someone is online: that seems to be fixed at least in moderately modern versions of FF - I tried to get a demo working of that earlier this summer, but the error messages accessible from the DOM are not as verbose anymore.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/831d085636d89cc6d141bacd63592351?s=256&amp;d=retro" alt="Baston"><span class="post-comment-author">Baston</span><div class="post-comment-content">Add-on like "secure login" for Firefox or the "magic wand" connection of Opera could prevent such hack. As one doesn't enter his credentials but they are fetch by the add-on if and only the page is the right one, the second login-dialogbox would not be filled ....
Or did i miss something ???</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/831d085636d89cc6d141bacd63592351?s=256&amp;d=retro" alt="Baston"><span class="post-comment-author">Baston</span><div class="post-comment-content">Of course, using such a trick for other malicious purpose would work .... :o(</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">I forgot to mention that there are other ways to detect when a user is logged on. think of dynamically generated css, image, swf and js files. all of them can be used to find the current user's state.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/606ab1a4939a8739b2d3eaae8bb281e4?s=256&amp;d=retro" alt="lavakumar"><span class="post-comment-author">lavakumar</span><div class="post-comment-content">Intresting post! I think other vectors also exist since same-origin-policy doesnt apply for the location object here. <code>window.location</code> normally returns the current URL of the window, so all data in URL can be stolen this way. I tried this in firebug:

<pre><code>w = window.open("http://gmail.com")
w.location = "https://gmail.com"
w.location = "https://gmail.com"</pre></code>

The second time I call w.location, it returns - <code>https&#58;//www.google.com/accounts/ServiceLogin?service=mail&amp;passive=true&amp;rm=false&amp;continue=https%3A%2F%2Fmail.google.com%2Fmail%2F%3Fui%3Dhtml%26zy%3Dl&amp;bsv=1k96igf4806cy&amp;ss=1&amp;ltmpl=default&amp;ltmplcache=2</code>

So even without redirecting to another fake website, we can get the session IDs if they are in the URL(even over SSL). Also most CSRF countermeasures add the unquie nonce to the URL (including ESAPI), this can also be used to bypass the anti-CRSF measures in selective cases.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/bede61f8751b864f0f0e686339a37429?s=256&amp;d=retro" alt="Matt"><span class="post-comment-author">Matt</span><div class="post-comment-content">Good write up; it seems like in principle our issue is that scripts from a previous page are running on the current one. The solution may be something along the lines of my understanding of the Google Chrome model. When you leave a site, that page dies with the executable and a new one is created for your new site; no residual triggers are left to be fired.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/a3ebc53bbf8294d4682b5c7124b91111?s=256&amp;d=retro" alt="lattera"><span class="post-comment-author">lattera</span><div class="post-comment-content">This attack isn't new. In fact, it's used in a standard called SCORM. SCORM requires a javascript API to be loaded in a parent frame (or window.opener if a pop-up). The javascript API must make calls in behalf of the SCORM module. The javascript API could do what it wants, including changing the location.href of another frame (or pop-up).</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">lavakumar, yes you can do that from Firebug but it wont work from a HTML page as far as I know, unless you are looking into some kind of a bug.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/9176aa3111a2d5729102a999a02754a6?s=256&amp;d=retro" alt="paulos"><span class="post-comment-author">paulos</span><div class="post-comment-content">Hello, yes you are right, there are many not discovered bugs, or just not released, design bugs in web browsers as you said. I think that the best way to detect/discover them all is just makeing more and more fuzzers, i am almost sure that there are many specific bugs :)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">hmmmmm, I don't think that fuzzers will work for finding design bugs... overflows yes, but not design bugs.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/606ab1a4939a8739b2d3eaae8bb281e4?s=256&amp;d=retro" alt="lavakumar"><span class="post-comment-author">lavakumar</span><div class="post-comment-content">Your are right, looks like it only works from firebug...my bad.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/95eeb4f5ff5ba4d22535ae1b4a9aeccd?s=256&amp;d=retro" alt="polonus"><span class="post-comment-author">polonus</span><div class="post-comment-content">Why is not there a decent online iFrame vulnerability scanner? We had Jutaky's iFrame Detektor, but that has gone offline somehow...

Now we have to construct our own queries like feed this to Google, and see how your firekeeper flags this...

polonus</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/7cedb843eb2922000eb41b4561ed660d?s=256&amp;d=retro" alt="The Rook (Michael Brooks)"><span class="post-comment-author">The Rook (Michael Brooks)</span><div class="post-comment-content">Hey PDP people are ripping off your research!  I guess its a complement of your visionary hacks :)

http://www.azarask.in/blog/post/a-new-type-of-phishing-attack/</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">I've long realised that research should stay as a hobby. :) rather than means for making money. There are other more practical ways of earning your living.</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2025 <a href=""></a>. All rights reserved.</p></footer></body></html>