<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Hacking Linksys IP Cameras (pt 2)</title><meta name="description" content="This article is a continuation of the following GNUCITIZEN article, which includes an introduction to the topic and also some initial observations: Hacking Linksys IP Cameras (pt 1)."><meta property="name" content="Hacking Linksys IP Cameras (pt 2)"><meta itemprop="name" content="Hacking Linksys IP Cameras (pt 2)"><meta property="description" content="This article is a continuation of the following GNUCITIZEN article, which includes an introduction to the topic and also some initial observations: Hacking Linksys IP Cameras (pt 1)."><meta itemprop="description" content="This article is a continuation of the following GNUCITIZEN article, which includes an introduction to the topic and also some initial observations: Hacking Linksys IP Cameras (pt 1)."><meta property="image" content="https://www.gnucitizen.org/files/2009/04/video_user_accounts.png &quot;Video User Accounts&quot;"><meta itemprop="image" content="https://www.gnucitizen.org/files/2009/04/video_user_accounts.png &quot;Video User Accounts&quot;"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/hacking-linksys-ip-cameras-pt-2/"><meta property="og:title" content="Hacking Linksys IP Cameras (pt 2)"><meta property="og:description" content="This article is a continuation of the following GNUCITIZEN article, which includes an introduction to the topic and also some initial observations: Hacking Linksys IP Cameras (pt 1)."><meta property="og:image" content="https://www.gnucitizen.org/files/2009/04/video_user_accounts.png &quot;Video User Accounts&quot;"><meta name="twitter:title" content="Hacking Linksys IP Cameras (pt 2)"><meta name="twitter:description" content="This article is a continuation of the following GNUCITIZEN article, which includes an introduction to the topic and also some initial observations: Hacking Linksys IP Cameras (pt 1)."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://www.gnucitizen.org/files/2009/04/video_user_accounts.png &quot;Video User Accounts&quot;"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Hacking Linksys IP Cameras (pt 2)</h1><div class="date">Mon, 20 Apr 2009 22:27:14 GMT</div><div class="author">by pagvac</div><div id="post-content"><p><em>This article is a continuation of the following GNUCITIZEN article, which includes an introduction to the topic and also some initial observations: <a href="/blog/hacking-linksys-ip-cameras-pt-1/">Hacking Linksys IP Cameras (pt 1)</a>.</em></p>
<h3 id="privilege-escalation-via-arbitrary-file-retrieval">Privilege escalation via arbitrary file retrieval</h3>
<p>The second vulnerability I&#39;ll be releasing is an arbitrary(ish) file retrieval vulnerability. It&#39;s not fully arbitrary because you can only retrieve the contents of files located within the same directory where the vulnerable CGI program is located. However, this is enough to allow a neat privilege escalation vector where a restricted user that only has permissions to view the video stream, can gain access to the <code>admin</code> account password.</p>
<p>The problem lies within the <code>next_file</code> parameter which is submitted to the <code>main.cgi</code> program. Although <code>main.cgi</code> <em>does</em> filter characters typically used in directory traversal sequences such as dots (<code>.</code>) and forward slashes (<code>/</code>), it seems that the developer didn&#39;t consider that retrieving the contents of files within the current directory could create a security hole. By simply retrieving the contents of <code>.htpasswd</code> a restricted user which only has permissions to access the video stream can access the credentials of the <code>admin</code> account and also the credentials of other restricted users (if applicable).</p>
<p>The only restriction that needs to be bypassed, is dots (<code>.</code>) symbols being filtered. i.e.: the following will <em>not</em> work and will result in a forbidden error:</p>
<pre><code>/img/main.cgi?next_file=.htpasswd

But replacing the dot (`.`) symbol with its hexadecimal equivalent:

/img/main.cgi?next_file=%2ehtpasswd

Will result in the contents of `.htpasswd` being returned. i.e.:

admin:adminpassw0rd user1:pass1 user2:pass2</code></pre><p>Like most IP cameras, the Linksys WVC54GCA allows administrators to grant access to the video stream to selected users only (rather than anonymous users who don&#39;t need to authenticate). In this case, the admin user can click on the <code>Users</code> menu and tick the <code>Only users in database</code> option (please see screenshot below). After this, all that is needed is to add a username/password pair for the account to grant video-viewing access to:</p>
<div class="screen">![Video User Accounts](/files/2009/04/video_user_accounts.png "Video User Accounts")</div>

<p>Well, the feature discussed above can be rendered useless by exploiting the vulnerability I have described, since it allows restricted users to retrieve the admin password.</p>
<h3 id="testing-info">Testing Info</h3>
<p>Successfully tested on:</p>
<ul>
<li>WVC54GCA</li>
<li>Firmware V1.00R22 and V1.00R24 (latest available as on 20th April 2009)</li>
</ul>
<p><em>Please note that this vulnerability is different to <a href="http://www.securityfocus.com/bid/10476/exploit">BID 10476</a> which affected the <code>/main.cgi</code> program rather than <code>/img/main.cgi</code>.</em></p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/8d7189421b28807d01436d5fa2efba35?s=256&amp;d=retro" alt="A"><span class="post-comment-author">A</span><div class="post-comment-content">If you can encode the dot using its hexadecimal representation, what prevents you from doing the same with slash, so you can achieve directory traversal?</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/9981128333e23cf10d35cf5c2eb80972?s=256&amp;d=retro" alt="chipxsd"><span class="post-comment-author">chipxsd</span><div class="post-comment-content">It really works ... damn, I'm throwing my camera under a VPN. Don't want nobody catching me in an awkward situation :/</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/0367b81839d31a5fa3d7bea79ef71b9e?s=256&amp;d=retro" alt="pagvac"><span class="post-comment-author">pagvac</span><div class="post-comment-content">@A: that doesn't work. thttpd's default forbidden error page is returned when trying so.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/95cff9e99f364a363e3dd43189899b23?s=256&amp;d=retro" alt="balt"><span class="post-comment-author">balt</span><div class="post-comment-content">That works indeed, as long as you're logged in. As long as you only allow one admin user and that's you, it is probably a non-issue.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/d72bfb37b3d2b0546d2aaac936b62aee?s=256&amp;d=retro" alt="Rayan"><span class="post-comment-author">Rayan</span><div class="post-comment-content">Correct, that only works if you are logged in in another browser session. Try that by closing down all your browsers and then try again with a clean session, it will prompt for the Username and password, if you skip that it will error out.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/0367b81839d31a5fa3d7bea79ef71b9e?s=256&amp;d=retro" alt="pagvac"><span class="post-comment-author">pagvac</span><div class="post-comment-content">@balt: indeed you need to be logged in. BUT, you DON'T need admin privileges. You can login as a RESTRICTED user (video-viewing permissions only), steal the admin password and finally login as admin. Thus, this vuln serves as a privilege escalation vector as explained in the post.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/7ab0bb8042f8d317499cbd2220faaf8b?s=256&amp;d=retro" alt="kwharrigan"><span class="post-comment-author">kwharrigan</span><div class="post-comment-content">Indeed.  If you have any user accounts enabled, and they have weak passwords, you might as well have given up your admin account. Seems it is better to run with no passwords than with them as your admin account password is now tied to the strength of N users accounts.

Wow.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/69b7e454a53bb71c404a467f510adda4?s=256&amp;d=retro" alt="Cam"><span class="post-comment-author">Cam</span><div class="post-comment-content">The more recent version of the firmware 1.100R2 resolves this important issue.  Thanks for pointing it out - I'm sure that's how Linksys/Cisco fixed the problem.  The software on this camera is still a joke- unsigned activeX control for a security camera.  That's crazy.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/69b7e454a53bb71c404a467f510adda4?s=256&amp;d=retro" alt="Cam"><span class="post-comment-author">Cam</span><div class="post-comment-content">Should have checked before posting - the latest 1.100R2 firmware includes a signed ActiveX control (finally!)</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2021 <a href=""></a>. All rights reserved.</p></footer></body></html>