<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Attack Of The URL Vulnerabilities</title><meta name="description" content="I think that it is getting worse. Billy Rios has discovered another critical Firefox issue related to the infamous bugs that has been recently discussed on multiple blogs including GC (us), Thor Larholm's blog, Mozilla's Security Blog, the 0x000000 hack zine and Billy (BK) Rios' personal blog. This time, the bug is extremely dangerous. Fortunately, the issue was fixed in the 2.0.0.6 release candidate."><meta property="name" content="Attack Of The URL Vulnerabilities"><meta itemprop="name" content="Attack Of The URL Vulnerabilities"><meta property="description" content="I think that it is getting worse. Billy Rios has discovered another critical Firefox issue related to the infamous bugs that has been recently discussed on multiple blogs including GC (us), Thor Larholm's blog, Mozilla's Security Blog, the 0x000000 hack zine and Billy (BK) Rios' personal blog. This time, the bug is extremely dangerous. Fortunately, the issue was fixed in the 2.0.0.6 release candidate."><meta itemprop="description" content="I think that it is getting worse. Billy Rios has discovered another critical Firefox issue related to the infamous bugs that has been recently discussed on multiple blogs including GC (us), Thor Larholm's blog, Mozilla's Security Blog, the 0x000000 hack zine and Billy (BK) Rios' personal blog. This time, the bug is extremely dangerous. Fortunately, the issue was fixed in the 2.0.0.6 release candidate."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fattack-of-the-url-vulnerabilities%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fattack-of-the-url-vulnerabilities%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/attack-of-the-url-vulnerabilities/"><meta property="og:title" content="Attack Of The URL Vulnerabilities"><meta property="og:description" content="I think that it is getting worse. Billy Rios has discovered another critical Firefox issue related to the infamous bugs that has been recently discussed on multiple blogs including GC (us), Thor Larholm's blog, Mozilla's Security Blog, the 0x000000 hack zine and Billy (BK) Rios' personal blog. This time, the bug is extremely dangerous. Fortunately, the issue was fixed in the 2.0.0.6 release candidate."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fattack-of-the-url-vulnerabilities%2F?w=1024"><meta name="twitter:title" content="Attack Of The URL Vulnerabilities"><meta name="twitter:description" content="I think that it is getting worse. Billy Rios has discovered another critical Firefox issue related to the infamous bugs that has been recently discussed on multiple blogs including GC (us), Thor Larholm's blog, Mozilla's Security Blog, the 0x000000 hack zine and Billy (BK) Rios' personal blog. This time, the bug is extremely dangerous. Fortunately, the issue was fixed in the 2.0.0.6 release candidate."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fattack-of-the-url-vulnerabilities%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/blog/">Blog</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Attack Of The URL Vulnerabilities</h1><div class="date">Wed, 25 Jul 2007 09:51:28 GMT</div><div class="author">by pdp</div><div id="post-content"><p>I think that it is getting worse. <a href="http://xs-sniper.com/blog/">Billy Rios</a> has discovered another critical Firefox issue related to the infamous bugs that has been recently discussed on multiple blogs including <a href="/blog/firefox-could-also-be-used-as-the-entry-point">GC</a> (us), <a href="http://larholm.com/2007/07/18/firefox-fixes-internet-explorer-flaw/">Thor Larholm</a>&#39;s blog, <a href="http://blog.mozilla.com/security/2007/07/23/related-security-issue-in-url-protocol-handling-on-windows/">Mozilla&#39;s Security Blog</a>, the <a href="http://www.0x000000.com/?i=401">0x000000</a> hack zine and <a href="http://xs-sniper.com/blog/2007/07/24/remote-command-execution-in-firefox-2005/">Billy (BK) Rios</a>&#39; personal blog. This time, the bug is extremely dangerous. Fortunately, the issue was fixed in the 2.0.0.6 release candidate.</p>
<p>Billy (BK) Rios comments:</p>
<blockquote>
<p>These examples were created for WinXP SP2 with no external mail programs installed (outlook, notes, etc). If you have an external mail program installed, these examples may not work on your machine (as the URI handling may have changed).</p>
</blockquote>
<blockquote>
<p>Once again, a flaw in the URI handling behavior allows for remote command execution. UNREGISTER ALL UNNECESSARY URIs NOW! This example shows flaws in Firefox, Netscape, and Mozilla browsers - other browsers are affected by related vulnerabilities.</p>
</blockquote>
<blockquote>
<p>Developers who intend to (or have already) registered URIs for their applications MUST UNDERSTAND that registering a URI handler exponentially increases the attack surface for that application. Please review your registered URI handling mechanisms and audit the functionality called by those URIs.</p>
</blockquote>
<p>The bug is within mailto, nntp, news and snews protocol handlers. Here is a harmless demonstration of the issue: <a href="mailto:%00%00../../../../../../windows/system32/cmd">danger do not click!</a>.</p>
<p><em>It seams like there is a huge interest in URL bug hunting. This is good. At least, we are going to get it right this time. Progressive security!</em></p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/290e868e00e8429bf1624a461b8ef81e?s=256&amp;d=retro" alt="Giorgio Maone"><span class="post-comment-author">Giorgio Maone</span><div class="post-comment-content">I'm won't say anything ;)
http://noscript.net/changelog#1.1.6.07</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">good, cuz I am not saying anything either :)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=256&amp;d=retro" alt="Jordan"><span class="post-comment-author">Jordan</span><div class="post-comment-content">Odd -- I've been trying to test this in a base XP image, with no luck.  Does it really require SP2 to work?  That'd be kind of ironic.  Outlook Express is the default registered mail handler for mailto: on the test system I just installed into vmware.  I'm going through the upgrades now, testing it at each step to see at what point it becomes vulnerable.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Jordan, the vector does not work if you have Outlook as a default <strong>mailto:</strong> handler. If your default Mail client is Thunderbird, then you shouldn't have any problem with launching the attack. BTW, try using other protocols. It works like a charm.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=256&amp;d=retro" alt="Jordan"><span class="post-comment-author">Jordan</span><div class="post-comment-content">pdp -- there's something else involved in the process that's disrupting it.

I just grabbed all the updates for the SP2 machine, and /now/ the exploit works.  Outlook Express is still registered as the mailto handler just like it was before I grabbed the updates.  

So in short, install a standard SP2 machine.  Exploit fails.  Install latest security patches.  Exploit succeeds.  

Lemme verify it again and use regmon to trace the registry calls to see if I can find out what's different.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=256&amp;d=retro" alt="Jordan"><span class="post-comment-author">Jordan</span><div class="post-comment-content">Ok, just ran it a second time after reverting the snapshot, and sure enough -- a base SP2 machine is /not/ vulnerable for some reason.  Got the regmon logs, but I don't have the time to parse through them right now.  

Here's a zip with a screenshot showing the exploit fail, regmon logs of the exploit both failing and then succeeding on the same machine just with and without patches:

http://www.psifertex.com/download/firefox-command-injection.zip

Maybe someone else can figure it out while I get back to pretending to work on this other project here at my office.  ;-)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/e262088c60a66120c5cf9ab4c54a3e17?s=256&amp;d=retro" alt="Adrian Pastor"><span class="post-comment-author">Adrian Pastor</span><div class="post-comment-content">It's very worrying how easy it is to exploit this vulnerability and how well it works.

I must research these URI handler bugs!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Jordan, again, it depends on the URL handler for the <strong>mailto:</strong> protocol.

Adrian, yes, yes and yes.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=256&amp;d=retro" alt="Jordan"><span class="post-comment-author">Jordan</span><div class="post-comment-content">pdp -- I realize that, but there's something else going on.  Check this out to see what I mean:

XPSP2 with no patches + Firefox = Exploit fails
XPSP2 with all patches (sans IE7) + Firefox = Exploit fails
XPSP2 with all patches (including IE7) + Firefox = Exploit succeeds!
XPSP2 with no patches + Firefox + Thunderbird installed and configured = Exploit fails
XPSP2 with no patches except for IE7 + Firefox + Thunderbird = Exploit succeeds!

I've tried other combinations besides those, and the only way I can get the exploit to succeed is if IE7 is installed.  If anyone's able to get the exploit working without IE7 installed, I'd be really curious to know.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/129b6f1bf6c627d5ca57779bd15ea649?s=256&amp;d=retro" alt="Jordan"><span class="post-comment-author">Jordan</span><div class="post-comment-content">Looks like I'm not the only person to observe that:

https://bugzilla.mozilla.org/show_bug.cgi?id=389580#c6</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Jordan, thanks for the good research. yes, it is very interesting. Have you taken snapshots of the registry tree for each setup? because now we can detect what's the cause of it. I have some very wild guess but it is good to have some proof. cheers</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2022 <a href=""></a>. All rights reserved.</p></footer></body></html>