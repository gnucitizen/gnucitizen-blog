<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>JavaScript Global Namespace Pollution</title><meta name="description" content="If you are reading this you are probably thinking what does this post has to do with security. Well, let me explain. One of the ways to detect JavaScript malware is to check for namespace pollutions symptoms. Simply put, if the JavaScript execution container contains more objects then the expected, something wrong is going on. This post will briefly walk through some ideas currently circulating in my head."><meta property="name" content="JavaScript Global Namespace Pollution"><meta itemprop="name" content="JavaScript Global Namespace Pollution"><meta property="description" content="If you are reading this you are probably thinking what does this post has to do with security. Well, let me explain. One of the ways to detect JavaScript malware is to check for namespace pollutions symptoms. Simply put, if the JavaScript execution container contains more objects then the expected, something wrong is going on. This post will briefly walk through some ideas currently circulating in my head."><meta itemprop="description" content="If you are reading this you are probably thinking what does this post has to do with security. Well, let me explain. One of the ways to detect JavaScript malware is to check for namespace pollutions symptoms. Simply put, if the JavaScript execution container contains more objects then the expected, something wrong is going on. This post will briefly walk through some ideas currently circulating in my head."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fjavascript-global-namespace-pollution%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fjavascript-global-namespace-pollution%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/javascript-global-namespace-pollution/"><meta property="og:title" content="JavaScript Global Namespace Pollution"><meta property="og:description" content="If you are reading this you are probably thinking what does this post has to do with security. Well, let me explain. One of the ways to detect JavaScript malware is to check for namespace pollutions symptoms. Simply put, if the JavaScript execution container contains more objects then the expected, something wrong is going on. This post will briefly walk through some ideas currently circulating in my head."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fjavascript-global-namespace-pollution%2F?w=1024"><meta name="twitter:title" content="JavaScript Global Namespace Pollution"><meta name="twitter:description" content="If you are reading this you are probably thinking what does this post has to do with security. Well, let me explain. One of the ways to detect JavaScript malware is to check for namespace pollutions symptoms. Simply put, if the JavaScript execution container contains more objects then the expected, something wrong is going on. This post will briefly walk through some ideas currently circulating in my head."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fjavascript-global-namespace-pollution%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/blog/">Blog</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">JavaScript Global Namespace Pollution</h1><div class="date">Thu, 07 Feb 2008 10:11:56 GMT</div><div class="author">by pdp</div><div id="post-content"><p>If you are reading this you are probably thinking what does this post has to do with security. Well, let me explain. One of the ways to detect JavaScript malware is to check for namespace pollutions symptoms. Simply put, if the JavaScript execution container contains more objects then the expected, something wrong is going on. This post will briefly walk through some ideas currently circulating in my head.</p>
<p>Namespace pollution checks are very trivial to perform. The check should be performed from a safer location such as outside of the execution sandbox or somewhere on the top before and after the user input is taken into consideration. The check is very simple really. All that needs to be done is to compare the list of registered objects with the expected list of objects. If they defer, the namespace has been polluted by something. The check can be performed by a function similar to the one discussed by the <a href="/blog/atom">Atom database</a> over <a href="/blog/atom#comment-16962">here</a>:</p>
<pre><code class="language-javascript"><span class="function"><span class="keyword">function</span> <span class="title">walkJSON</span>(<span class="params">j, c</span>) </span>{
    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> j) {
        c(i, j[i]);

        <span class="keyword">if</span> (j[i] <span class="keyword">instanceof</span> <span class="built_in">Array</span> || <span class="keyword">typeof</span>(j[i]) == <span class="string">'object'</span>) {
            <span class="built_in">arguments</span>.callee(j[i], c);
        }
    }
}</code></pre>
<p>The function is very simple as you can see, though you have to be careful when used from chrome privileged code. As you can see the if statement comparisons can be used in order to escalate access, something known as chrome execution attack. Nevertheless, the function is sufficient enough to walk any JavaScript object. You can even make it recursive if you want to go several levels down the tree. By using this function, we can compare the namespace before and after and as such detect and locate malicious code.</p>
<p>This is what I believe will be one of the techniques used by anti-malware software to prevent, but mostly to detect and locate, malicious code. Nevertheless, there are always methods that can be used to overcome namespace pollution problems. One of them is to use closures. Here is an example:</p>
<pre><code class="language-javascript">(<span class="function"><span class="keyword">function</span> (<span class="params">window, document</span>) </span>{
    <span class="comment">// [evil code here]</span>
})(<span class="built_in">window</span>, <span class="built_in">document</span>);</code></pre>
<p>This technique will safely execute malicious code without the need to worry about polluting the whichever namespace, as long as the evil code that is enclosed within the closure does not modify the window or the document objects. DOM manipulation is acceptable since no one is crazy enough to check for DOM changes. The document object is far more complicated and walking it is hard.</p>
<p>As you can see closures can be used to hide evil code. Another way for obscuring evil code is to make use of the prototype functionalities of the interpreter. The prototype object, and several other special objects, that are enclosed within every object instance can be used to hide facilities which cannot be easily spotted by JavaScript malware detection engines. Simply put, synthetic sugar, something JavaScript has plenty of, is a perfect place for storing evil code without polluting the namespace for triggering any other canary that might be there.</p>
<p><em>Take this post and put it aside until you need it</em>.</p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/cf09578bc47ef46a1989b160374bc11d?s=256&amp;d=retro" alt="Rey Bango"><span class="post-comment-author">Rey Bango</span><div class="post-comment-content">Thanks for this post pdp. I gave you some press over on Ajaxian.com. http://ajaxian.com/archives/security-focus-javascript-global-namespace-pollution

I hope to see more of this type of content. Please keep me abreast of any JS/Ajax/DOM content so I can continue to post on Ajaxian.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Rey, 10x for pointing out our security materials on Ajaxian. we will keep up with some good JavaScript research :)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/cf09578bc47ef46a1989b160374bc11d?s=256&amp;d=retro" alt="Rey Bango"><span class="post-comment-author">Rey Bango</span><div class="post-comment-content">Thx pdp. Security is an important topic to me both from a development and systems perspective and I really appreciate the work that your team is doing. Billy Hoffman's new book, Ajax Security, is next on my reading list. :)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">apparently a good book but I have no idea what it is inside. though, I trust Billy's work.</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2021 <a href=""></a>. All rights reserved.</p></footer></body></html>