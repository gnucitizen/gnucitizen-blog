<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Backdooring MP3 Files</title><meta name="description" content="Recently I published information on how specially crafted HTML (remote and local), Flash and QuickTime (.mov) files can be used by malicious users to target and exploit internal and external networks. Than my friend and college David K released his findings on backdooring PDF documents via builtin Adobe Reader JavaScript features. Also, JavaScript malware via Google AJAX Search API seams to be possible and could affect many popular web products. As Billy Hoffman said &quot;XSS is the new hotness!&quot;. I cannot agree more on that."><meta property="name" content="Backdooring MP3 Files"><meta itemprop="name" content="Backdooring MP3 Files"><meta property="description" content="Recently I published information on how specially crafted HTML (remote and local), Flash and QuickTime (.mov) files can be used by malicious users to target and exploit internal and external networks. Than my friend and college David K released his findings on backdooring PDF documents via builtin Adobe Reader JavaScript features. Also, JavaScript malware via Google AJAX Search API seams to be possible and could affect many popular web products. As Billy Hoffman said &quot;XSS is the new hotness!&quot;. I cannot agree more on that."><meta itemprop="description" content="Recently I published information on how specially crafted HTML (remote and local), Flash and QuickTime (.mov) files can be used by malicious users to target and exploit internal and external networks. Than my friend and college David K released his findings on backdooring PDF documents via builtin Adobe Reader JavaScript features. Also, JavaScript malware via Google AJAX Search API seams to be possible and could affect many popular web products. As Billy Hoffman said &quot;XSS is the new hotness!&quot;. I cannot agree more on that."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbackdooring-mp3-files%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbackdooring-mp3-files%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/backdooring-mp3-files/"><meta property="og:title" content="Backdooring MP3 Files"><meta property="og:description" content="Recently I published information on how specially crafted HTML (remote and local), Flash and QuickTime (.mov) files can be used by malicious users to target and exploit internal and external networks. Than my friend and college David K released his findings on backdooring PDF documents via builtin Adobe Reader JavaScript features. Also, JavaScript malware via Google AJAX Search API seams to be possible and could affect many popular web products. As Billy Hoffman said &quot;XSS is the new hotness!&quot;. I cannot agree more on that."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbackdooring-mp3-files%2F?w=1024"><meta name="twitter:title" content="Backdooring MP3 Files"><meta name="twitter:description" content="Recently I published information on how specially crafted HTML (remote and local), Flash and QuickTime (.mov) files can be used by malicious users to target and exploit internal and external networks. Than my friend and college David K released his findings on backdooring PDF documents via builtin Adobe Reader JavaScript features. Also, JavaScript malware via Google AJAX Search API seams to be possible and could affect many popular web products. As Billy Hoffman said &quot;XSS is the new hotness!&quot;. I cannot agree more on that."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fbackdooring-mp3-files%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Backdooring MP3 Files</h1><div class="date">Wed, 20 Sep 2006 21:39:18 GMT</div><div class="author">by pdp</div><div id="post-content"><p>Recently I published information on how specially crafted HTML (<a href="/blog/backdooring-web-pages">remote</a> and <a href="/blog/web-pages-from-hell">local</a>), <a href="/blog/backdooring-flash-objects">Flash</a> and <a href="/blog/backdooring-quicktime-movies">QuickTime (.mov)</a> files can be used by malicious users to target and exploit internal and external networks. Than my friend and college <a href="http://michaeldaw.org">David K</a> released his findings on <a href="http://michaeldaw.org/md-hacks/backdooring-pdf-files/">backdooring PDF</a> documents via builtin Adobe Reader JavaScript features. Also, <a href="/blog/google-search-api-worms">JavaScript malware via Google AJAX Search API</a> seams to be possible and could affect many popular web products. As Billy Hoffman said &quot;XSS is the new hotness!&quot;. I cannot agree more on that.</p>
<h3 id="mp3-files-can-be-backdoored-with-malicious-content-too">MP3 Files can be Backdoored with Malicious Content too</h3>
<p>Over the past few days I have been exploring different features of Apple&#39;s QuickTime player - key software component of iTunes and standard part of many home and business workstations. A lot of research was conducted and some problems, which IMHO are quite serious, were found. Please take this post as a security notice.</p>
<p>QuickTime is quite versatile and flexible media platform which has a lot of functionalities. I quite like it, I must say. I even use iTunes on a daily basis. Unfortunately because of its flexibility QuickTime seams to allow execution of malicious content in a form of JavaScript from media files such as mp3, mp4, m4a and everything else that is supported.</p>
<p>The problems is caused by a quite useful feature called QuickTime Media Link (.qtl). The whole point of these QuickTime Media Link files is to provide means of playing media files in a more accessible way. In this respect the developer can create a .qtl file which hold information about the media content that needs to be played plus recommended dimensions, accessibility features, control features etc. QuickTime Media Link files are written in XML and end typically end with .qtl. A .qtl file in its very basic form looks like the following:</p>
<pre><code class="language-xml"><span class="meta">&lt;?xml version="1.0"&gt;
&lt;?quicktime type="application/x-quicktime-media-link"?&gt;</span>
<span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">"Sample.mov"</span> <span class="attr">autoplay</span>=<span class="string">"true"</span>/&gt;</span></code></pre>
<p>The most important element in this XML is called <code>embed</code>. This element describes the content that needs to be played. There are quite few attributes that can be assigned to the <code>embed</code> element like <code>src</code> and <code>autoplay</code> but they are not as interesting as <code>qtnext</code>. The <code>qtnext</code> attribute specifies what needs to be played next. Because <code>qtnext</code> expects a URL as an input, .qtl files are capable of opening HTML pages, local files, FTP sites and JavaScript code in the current browser. As such, <code>qtnext</code> allows successful backdooring any .qtl file with malicious JavaScript logic. Here it is an example:</p>
<pre><code class="language-xml"><span class="meta">&lt;?xml version="1.0"&gt;
&lt;?quicktime type="application/x-quicktime-media-link"?&gt;</span>
<span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">"presentation.mov"</span> <span class="attr">autoplay</span>=<span class="string">"true"</span> <span class="attr">qtnext</span>=<span class="string">"javascript:alert('backdoored')"</span>/&gt;</span></code></pre>
<p>Upon execution the media link presented above will display a harmless message to the user. Keep in mind that a lot more dangerous things can be done. For more information about the impact of such an attack check the <a href="/blog/attackapi">AttackAPI</a> - a toolkit designed to test browser related issues.</p>
<p>To sum up, .qtl files can contain malicious JavaScript code that can takeover some important network device when executed for example. That&#39;s not the end of the story though. Because of its flexibility QuickTime doesn&#39;t mind if Media Link (.qtl) files end with .mp3, .mp4, .m4a or even .mov. For example the following XML can be saved as .mp3 and once opened in QuickTime a harmless message will be prompted to the user:</p>
<pre><code class="language-xml"><span class="meta">&lt;?xml version="1.0"&gt;
&lt;?quicktime type="application/x-quicktime-media-link"?&gt;</span>
<span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">"http://example.com/path/to/real/song.mp3"</span> <span class="attr">autoplay</span>=<span class="string">"true"</span> <span class="attr">qtnext</span>=<span class="string">"javascript:alert('hello from backdoor')"</span>/&gt;</span></code></pre>
<p>This is a quite big problem especially in default configurations of iTunes. The iTunes installation wizard installs the QuickTime player and QuickTime browser plugins and associates various media files with its components. If you open a mp3 file from the desktop it will be played in iTunes player by default, however if you open it from some website it will be played in the QuickTime player browser plugin. In this respect, users who are previewing mp3s and other media files from the Internet are vulnerable.</p>
<p>For the sole purpose of demonstrating how this vulnerability works I composed a quite simple and harmless proof of concept. There are two links to mp3 files at the bottom of this page. Two of these files are backdoored. One of them is a tune I composed many years ago.</p>
<ol>
<li><a href="/files/2006/09/backdoored.mp3">backdoored.mp3</a> - executes javascript immediately</li>
<li><a href="/files/2006/09/jamesbond-overdrive-backdoored.mp3">jamesbond-overdrive-backdoored.mp3</a> - executes javascript at the end</li>
<li><a href="/files/2006/09/jamesbond-overdrive.mp3">jamesbond-overdrive.mp3</a> - the real tune</li>
</ol>
<p>I mentioned earlier that .qtl files can end with .mov, .avi or even .asf extensions. This means that users can be fooled into executing malicious JavaScript content not only through mp3.</p>
<p>There is one more thing that is quite important to point in this article. JavaScript opened from QuickTime is executed in the browser local context. This attack is also know as <a href="/blog/cross-context-scripting">Cross-context scripting</a>. In Firefox the context is <code>about:blank</code>. I am not quite familiar with <code>about:blank</code> but my understandings are that everything from <code>about:*</code> can request special privileges that will be granted without warning the user. If this the case malicious JavaScript will not only be able to read the local file system but also to alter it. This feature might be used to spread worms that go far beyond the traditional Cross-site Scripting attack.</p>
<p><em>Proof of concept for this issue can be found at the following <a href="/files/2006/09/about-blank.mp3">URL</a>.</em></p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/d651c8bfbaced80509519278b350d9bc?s=256&amp;d=retro" alt="Allan"><span class="post-comment-author">Allan</span><div class="post-comment-content">Hmm doesn't seem to do anything on my Mac ...</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/3e0298a2854e87166f6ddcee1fe4e005?s=256&amp;d=retro" alt="nrg"><span class="post-comment-author">nrg</span><div class="post-comment-content">Once again very good and intresting research. So basicly anything played in quicktime can be backdored? So basicly this is a quicktime problem. I am not an iTunes user but if you say that quicktime gets installed with it and used has default for several media files then it gets a bit scary :S

I personly only use quicktime(not actual quicktime but the alternative codecs) when i can't use anything else, but i believe most persons would use quicktime to play everything if its the default player.

PS: I just tryed the files number 1 and 2 and they won't open (say the files are corrupt) in winamp nor media player classic nor foobar2000, so i guess backdoring a mp3 file makes it only open in quicktime.

keep posting mate</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Allan, I don't know about MACs. However I am almost sure that it must work. Maybe I should get a MAC from somewhere and start playing with it.

nrg, yes it affects QuickTime and everything else that is based on it. As long as your applications can read QuickTime Media Links and it supports the <code>qtnext</code> attribute of the <code>embed</code> element, then you are vulnerable.

QuickTime is associated with .mov files mainly and several other formats. However if you have iTunes installed any .mp3 link will open the QuickTime browser plugin. I have tested it on a default installation of iTunes.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/1d95d2324345e3dd2e41d6066cc1b492?s=256&amp;d=retro" alt="David Kierznowski"><span class="post-comment-author">David Kierznowski</span><div class="post-comment-content">pdp,

This doesn't seem to affect v6.5 default install. This is odd as I can see support for qtnext back in version 5. However, it does affect the latest version when I tested it.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/abd931e5b40e5c82cf649e8c3d17556f?s=256&amp;d=retro" alt="Carsten Eilers"><span class="post-comment-author">Carsten Eilers</span><div class="post-comment-content">Hi,

I tested the first two .mp3 on my Mac (Mac OS X 10.3.9 with Safari 1.3.2 and Quicktime Player 7.1.3)

Result:
In Safari: Both demos are working, an alertbox opens
In Quicktime Player: Opens and "plays" the files, but nothing else happens
In iTunes 7.0: Doesn't open the files

Regards
Carsten</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/163df81d09d5d17ddeb3ddad0a0662a3?s=256&amp;d=retro" alt="Daniel Veditz"><span class="post-comment-author">Daniel Veditz</span><div class="post-comment-content">about:blank is as unprivileged as you can get in Firefox. Some about: pages are privileged (about:config, for example) and there were previous security vulnerabilities where researchers were able to leverage a "same-origin violation" flaw into code execution by injecting script into an about:config window or frame.

But about:blank is a different kettle of fish.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Hi Daniel,

I was experimenting with about:blank and yes you are right, it is unprivileged. However, it seams that it could be possible to access other about: resources.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/357a20e8c56e69d6f9734d23ef9517e8?s=256&amp;d=retro" alt="ankini shah"><span class="post-comment-author">ankini shah</span><div class="post-comment-content">I copied the code below to a text file, saved it and named it a .mp3 and it didn't give me a prompt.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/357a20e8c56e69d6f9734d23ef9517e8?s=256&amp;d=retro" alt="ankini shah"><span class="post-comment-author">ankini shah</span><div class="post-comment-content">the first example backdoored mp3 didn't work for me, but the second one (which printed at the end) did.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/c4db4e65c9f09f2a373fcaefa5e2bfb4?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">this issue is also present in Windows Media Player Clasic with QuickTime Alternative. I wasn't able to execute it from the browser but there was no problem when files were opened from the desktop.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/2ece1125c061d1e98e9b05e600e3c20a?s=256&amp;d=retro" alt="Almonaster"><span class="post-comment-author">Almonaster</span><div class="post-comment-content">Some more data: I gave the links a click using Firefox 1.5 - the backdoors did nothing, the genuine tune played. I use the NoScript extension, so I tried disabling that - same result.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/56f6f443baedee2af74f0b6a1f7f34ee?s=256&amp;d=retro" alt="abcas"><span class="post-comment-author">abcas</span><div class="post-comment-content">usefull cuzz it happened 2 me every tim i just explore a file with mp3 in it the explorer closes and starts again and when i scanned my comp i found the amount pf viruses = 2 the amount of songs (mp3 files) but i really cant fix it can u help me ????</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/76c2e8ea0d24b4a306ae5248d7474608?s=256&amp;d=retro" alt="yamzzz"><span class="post-comment-author">yamzzz</span><div class="post-comment-content">nice!!!!!!!!!!</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/6a6c19fea4a3676970167ce51f39e6ee?s=256&amp;d=retro" alt="0ole"><span class="post-comment-author">0ole</span><div class="post-comment-content">Doesn't works on Mac OS X with the latest Quicktime updates. Might be a Windows Quicktime only problem then.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/752611fa9c8acbdd0152f40da21c22ea?s=256&amp;d=retro" alt="Ari"><span class="post-comment-author">Ari</span><div class="post-comment-content">Nice work ! But Kaspersky AV blocks these backdoored mp3 files.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/17d6341e77fe4d53a943d53009d31e5a?s=256&amp;d=retro" alt="tapasman"><span class="post-comment-author">tapasman</span><div class="post-comment-content">I get a broken file, when using IE6 and QT 6.0.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/41029836a736fd04dd8ddbd44bfc7a3c?s=256&amp;d=retro" alt="Mary"><span class="post-comment-author">Mary</span><div class="post-comment-content">Hi, thanks. but my Kaspersky AV blocks this files :(</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2021 <a href=""></a>. All rights reserved.</p></footer></body></html>