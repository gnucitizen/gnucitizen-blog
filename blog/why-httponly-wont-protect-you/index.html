<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Why HttpOnly Won't Protect You</title><meta name="description" content="Before going in depth criticizing the HttpOnly session protection mechanism I better explain what it is and why it is useful."><meta property="name" content="Why HttpOnly Won't Protect You"><meta itemprop="name" content="Why HttpOnly Won't Protect You"><meta property="description" content="Before going in depth criticizing the HttpOnly session protection mechanism I better explain what it is and why it is useful."><meta itemprop="description" content="Before going in depth criticizing the HttpOnly session protection mechanism I better explain what it is and why it is useful."><meta property="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fwhy-httponly-wont-protect-you%2F?w=1024"><meta itemprop="image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fwhy-httponly-wont-protect-you%2F?w=1024"><meta property="og:type" content="website"><meta property="og:url" content="https://www.gnucitizen.org/blog/why-httponly-wont-protect-you/"><meta property="og:title" content="Why HttpOnly Won't Protect You"><meta property="og:description" content="Before going in depth criticizing the HttpOnly session protection mechanism I better explain what it is and why it is useful."><meta property="og:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fwhy-httponly-wont-protect-you%2F?w=1024"><meta name="twitter:title" content="Why HttpOnly Won't Protect You"><meta name="twitter:description" content="Before going in depth criticizing the HttpOnly session protection mechanism I better explain what it is and why it is useful."><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://s.wordpress.com/mshots/v1/https%3A%2F%2Fwww.gnucitizen.org%2Fblog%2Fwhy-httponly-wont-protect-you%2F?w=1024"><link type="text/css" href="/blog.css" rel="stylesheet"><script type="text/javascript" src="/blog.js"></script></head><body><header id="header"><h1><a href="/"></a></h1><p></p></header><nav id="topnav"><ul><li><a href="/">Home</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/files">Files</a></li><li><a href="/about.html">About</a></li></ul></nav><article><div id="content"><h1 class="title">Why HttpOnly Won't Protect You</h1><div class="date">Thu, 12 Apr 2007 08:27:07 GMT</div><div class="author">by pdp</div><div id="post-content"><p>Before going in depth criticizing the <strong>HttpOnly</strong> session protection mechanism I better explain what it is and why it is useful.</p>
<p><strong>HttpOnly</strong> is a session protection mechanism, as we established from the previous paragraph, which is used in situations where the session cookie is not required to be available inside the application DOM. Session identifiers are responsible for keeping the state between the browser and the remote server. They are needed only for this reason. In situations where the client or the server is vulnerable to XSS (Cross-site Scripting), attackers can easily retrieve the session identifier by querying the <code>document.cookie</code> object. The retrieved information can be sent to a remote collection point which is controlled by the attacker. Once the session identifier is collected, the attacker will be able to hijack the user session.</p>
<p><strong>HttpOnly</strong> is a an option which specifies that the cookie (session identifiers included) should not be accessed from the application DOM. In that case the attacker cannot hijack the session because <code>document.cookie</code> will not return anything useful.</p>
<p>IMHO, <strong>HttpOnly</strong> create a false sense of security. <strong>HttpOnly</strong> does not solve any problem at all. For more information about <strong>HttpOnly</strong>, you can read the MSND <a href="http://msdn.microsoft.com/workshop/author/dhtml/httponly_cookies.asp">article</a>. The article is entitled &quot;Mitigating Cross-site Scripting With HTTP-only Cookies&quot; which I think is quite wrongly put. Here is a typical example of how to declare a HttpOnly session identifier:</p>
<pre><code>Set-Cookie: SESSIONID=[token]; HttpOnly</code></pre><p>The <strong>HttpOnly</strong> protection mechanism is useful only in case where the attacker is not skillful enough to undertake other means for attacking the remote application and subsequently the user. Although, session hijacking is still considered the only thing you can do when having XSS, this is for from what is actually possible. The truth is that session hijacking is probably one of the least things the attacker will do for a number of reasons. The most obvious reason is that XSS attacks, although could be targeted, are not instant, like traditional buffer overflow attacks where the attacker point the exploit to a remote location and gain access right away. For an XSS attack to be successful, sometimes it is required a certain period of time to pass until the victim opens a link or do something else. It is highly unlikely that the attacker will wait all the time just to get a session which could be invalidated a couple of moments later when the user clicks on the <strong>logout</strong> button. Remember, session hijacking is possible because concurrent sessions are possible.</p>
<p>The only and most effective way to attack when having a XSS hole is to launch an attack right on place when the payload is evaluated. If the attacker needs to transfer funds or obtain sensitive information, she most probably will use the <code>XMLHttpRequest</code> object in the background, to automate the entire process. Once the operation is completed, the attacker could leave the user to continue with their normal work or maybe even gain full control of the account my resetting the password and destroying the session by performing a logout operation.</p>
<p><strong>HttpOnly</strong> does not protect against all that and it never will. If you plan to use this technology keep in mind that you are still required to make sure that your site/application is XSS free.</p>
<p><em>If implementing the <strong>HttpOnly</strong> protection mechanism introduces other problems, you may safely ignore it for the time being. Concentrate on the user input and make sure that nothing is rendered without being carefully sanitized.</em></p>
</div><div id="post-comments"><p><em>Archived Comments</em></p><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt=".mario"><span class="post-comment-author">.mario</span><div class="post-comment-content">I totally agree - if a site is XSSable already HTTPOnly cookies fix nothing. When not including a library like jQuery or Prototype it's way easier to create and event-submit a new form that foging a XHR.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="christ1an"><span class="post-comment-author">christ1an</span><div class="post-comment-content">Thanks for this nice writeup, I also think that (unfortunately) a lot of people have a totally wrong understanding of HttpOnly cookies. For those I hope this page comes up first on Google when searching for HttpOnly ;)

Apart from that, nothing to add or criticize.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="rezn"><span class="post-comment-author">rezn</span><div class="post-comment-content">This is a nice description, however I want to point out a small (perhaps semantic) error which I often find people actually believe:

"Remember, session hijacking is possible because concurrent sessions are possible."

Many people seem to believe this, and thus also believe that if they structure their applications so as to prevent a single user from having multiple concurrent sessions that they are safe from XSS.  Using someone's cookies does -not- create a new session - the attacker is sharing a single session with the target.  From the application's point of view, this looks like 1 session, not 2 concurrent sessions.

While this is obvious to attackers, it is not always obvious to developers, so I think its important not to propagate the misunderstanding.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">rezn,

I see what you mean. However, the simplest probably check you can do is to verify whether the IP of the user changes. Although in some cases, that could be a problem, since a lot of user could use the same proxy server, it still can improve the situation.

You are saying:

<blockquote>Many people seem to believe this, and thus also believe that if they structure their applications so as to prevent a single user from having multiple concurrent sessions that they are safe from XSS.</blockquote>

I don't think that this is the case, although I see how this could tern out to be a problem when the developer does not have good understanding on what is XSS and what damage it can cause.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="santa claus"><span class="post-comment-author">santa claus</span><div class="post-comment-content">I want to see if i have this straight.
You say that HTTPOnly is completely useless because an attacker doesn't care about cookie information or hijacking sessions, he only cares about CSRFing you into doing something evil.

Well, what if the only important thing to the attacker is getting the cookie information? (say, super-duper top secret information is stored there). Then what does the attacker do? 

I thought you were going to explain an easy way to bypass httponly and get the data stored in cookies. 
I still think if all you care about is protecting the cookie info from being stolen then httponly is a decent defense. Please correct me.

(The only way i know of bypassing httponly is through the TRACE method that jeremiah wrote a whitepaper about. Are there other ways?)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">santa claus,

you are saying:

<blockquote>You say that HTTPOnly is completely useless because an attacker doesnâ€™t care about cookie information or hijacking sessions, he only cares about CSRFing you into doing something evil.</blockquote>

no.. this is not what I am saying. All I am saying is that you shouldn't relay on HttpOnly cookies to protect against XSS attacks because session hijacking is one of the many things an attacker can do. In fact, most of the times you are not going to perform session hijacking simply because it takes time to get the victim at the right state.

If <q>super-duper top secret information is stored there</q> (the cookies) well then you cannot do much unless you use some sort of browser exploit. However, if <q>super-duper top secret information is stored there</q> then the client side won't be able to access it either. What's the point of having info there if you cannot use it. Your server side can access the cookie but again, why do you want to store sensitive information in a cookie? What is the purpose? If someone stores sensitive information in cookies, they are basically asking for trouble.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="santa claus"><span class="post-comment-author">santa claus</span><div class="post-comment-content">pdp,

Ok, thanks for clearing that up. 
I understand what you are saying better now..
Great post as always! =]</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Acidus"><span class="post-comment-author">Acidus</span><div class="post-comment-content">pdp, You are my hero. Well, my hero after Samy of course.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">Acidus, no no, You are my hero.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="RSnake"><span class="post-comment-author">RSnake</span><div class="post-comment-content">This is really old news.  This was covered in an email by Thor Larholm 4 years ago:  http://www.securityfocus.com/archive/1/307778</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">RSnake, yup... it is old news. Keep in mind though, that everything new is well forgotten old thing. For example, XSS used to be consider quite lame attack, although it is still quite easy to exploit, until the point some people forgot about it. However, today, XSS is considered as one of the most dangerous Web Application threads. Maybe my example is very clear but, again, keep in mind the following:

<blockquote>Everything new is well forgotten old thing.</blockquote></div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Bipin 3~ Upadhyay"><span class="post-comment-author">Bipin 3~ Upadhyay</span><div class="post-comment-content"><blockquote>Everything new is well forgotten old thing.</blockquote>

Agreed completely. :)

BTW, although HttpOnly doesn't do *much*, yet we cannot deny that it does *something*. Adding another layer to the "Onion Model" is (most of the times) a welcome, IMHO.

@PDP:
I like the way you write. Most of the times, providing an overview of (or pointers to) basics for noobs. :)</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="pdp"><span class="post-comment-author">pdp</span><div class="post-comment-content">I am glad to hear that.</div></div><div class="post-comment"><img class="post-comment-avatar" src="//gravatar.com/avatar/#{comment.avatar}?s=256&amp;d=retro" alt="Roy"><span class="post-comment-author">Roy</span><div class="post-comment-content">I agree it will not (fully) protect you but I strongly recommend having HttpOnly turned on as it improves security by hiding your session id.</div></div></div></div></article><footer id="footer"><p>Copyright &copy; 2020 <a href=""></a>. All rights reserved.</p></footer></body></html>